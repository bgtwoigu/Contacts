<html>
<head>
  <title>4Camera软件架构</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="408"/>
<h1>4Camera软件架构</h1>

<div>
<span><div><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">主要包含三个部分的介绍：</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">1)Android Camera </span><span style="font-size: 12pt; color: black; font-family: 宋体;">架构：<span>Android</span>系统原生架构简要介绍.</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">2)Mediatek Android Camera</span><span style="font-size: 12pt; color: black; font-family: 宋体;">架构<span>: </span>简要介绍<span>Mediatek</span>平台在<span>Android</span>系统基础上<span>Camera </span>的架构<span>.</span></span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">3)Camera data path: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">介绍在平台端<span>Camera</span>的数据流<span>.</span></span></p><p style="margin: 0cm 0cm 0pt;"><span style="background: yellow; color: black; font-family: 宋体;">1.下图为</span><span style="background: yellow; color: black;">Android Camera </span><span style="background: yellow; color: black; font-family: 宋体;">架构</span></p><img alt="android camera architecture" src="https://onlinesso.mediatek.com/UploadedPirctures/6353273894094339591624561240%E6%96%B0%E5%9B%BE%E7%89%87%281%29.bmp"></img><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera</span><span style="font-size: 12pt; color: black; font-family: 宋体;">根据</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Android </span><span style="font-size: 12pt; color: black; font-family: 宋体;">架构从上至下可分为</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">    1)Applications: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">最上层的应用，编译后生成</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera  APK</span><span style="font-size: 12pt; color: black; font-family: 宋体;">；</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">    2)Application Framework: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">主要为</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Applications</span><span style="font-size: 12pt; color: black; font-family: 宋体;">提供</span><span style="font-size: 12pt; color: black; font-family: 宋体;">API;</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">    3)JNI: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">使</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Application Framework</span><span style="font-size: 12pt; color: black; font-family: 宋体;">和</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Libraries</span><span style="font-size: 12pt; color: black; font-family: 宋体;">可交互</span><span style="font-size: 12pt; color: black; font-family: 宋体;">; </span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">    4)Libraries: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">包括</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera Framework</span><span style="font-size: 12pt; color: black; font-family: 宋体;">和</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera Service(camera service</span><span style="font-size: 12pt; color: black; font-family: 宋体;">和</span><span style="font-size: 12pt; color: black; font-family: 宋体;">camera client);</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">    5)HAL: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">硬件抽象层</span><span style="font-size: 12pt; color: black; font-family: 宋体;">, </span><span style="font-size: 12pt; color: black; font-family: 宋体;">用来链接</span><span style="font-size: 12pt; color: black; font-family: 宋体;">driver</span><span style="font-size: 12pt; color: black; font-family: 宋体;">和</span><span style="font-size: 12pt; color: black; font-family: 宋体;"> Camera Service;</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">    6)Kernel: image sensor driver</span><span style="font-size: 12pt; color: black; font-family: 宋体;">的实作</span><span style="font-size: 12pt; color: black; font-family: 宋体;">. </span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">其中<span>2)</span>～<span>4)</span>的部分基本为<span>Android</span>原生的架构和<span>code</span>，<span>Mediatek</span>会有一些拓展<span>,</span>而<span>HAL</span>和<span>Kernel</span>层为<span>Mediatek</span>主要实作的部分，<span>Camera APK</span>是<span>Mediatek</span>基于<span>Android </span>原生<span>Camera APK</span>修改的应用<span>.</span></span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"> </p><ol start="2"><li style="margin: 0cm 0cm 0pt; text-align: left;"><span style="background: yellow; color: black;"></span><span style="background: yellow; color: black; font-family: 宋体;">下</span><span style="background: yellow; color: black; font-family: 宋体;">图为</span><span style="background: yellow; color: black;">MT6589/82/72/92/88</span><span style="background: yellow; color: black; font-family: 宋体;">平台基于</span><span style="background: yellow; color: black;">Android</span><span style="background: yellow; color: black; font-family: 宋体;">架构上</span><span style="background: yellow; color: black;">, </span><span style="background: yellow; color: black; font-family: 宋体;">，</span><span style="background: yellow; color: black;">Camera</span><span style="background: yellow; color: black; font-family: 宋体;">从</span><span style="background: yellow; color: black;">application</span><span style="background: yellow; color: black; font-family: 宋体;">到</span><span style="background: yellow; color: black;">kernel</span><span style="background: yellow; color: black; font-family: 宋体;">层详细的架构</span><span style="background: yellow; color: black;">.</span></li></ol><img alt="Mediatek Camera Architecture" src="https://onlinesso.mediatek.com/UploadedPirctures/6353273945725438371841418795%E6%96%B0%E5%9B%BE%E7%89%87%282%29.bmp"></img><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">1)</span><span style="font-size: 12pt; color: black; font-family: 宋体;">蓝色部分主要由</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Java</span><span style="font-size: 12pt; color: black; font-family: 宋体;">实现</span><span style="font-size: 12pt; color: black; font-family: 宋体;">(</span><span style="font-size: 12pt; color: black; font-family: 宋体;">偏向应用层</span><span style="font-size: 12pt; color: black; font-family: 宋体;">)</span><span style="font-size: 12pt; color: black; font-family: 宋体;">、黄色为</span><span style="font-size: 12pt; color: black; font-family: 宋体;">JNI</span><span style="font-size: 12pt; color: black; font-family: 宋体;">实现</span><span style="font-size: 12pt; color: black; font-family: 宋体;">(C++</span><span style="font-size: 12pt; color: black; font-family: 宋体;">，衔接</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Java</span><span style="font-size: 12pt; color: black; font-family: 宋体;">层和</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Native</span><span style="font-size: 12pt; color: black; font-family: 宋体;">层</span><span style="font-size: 12pt; color: black; font-family: 宋体;">)</span><span style="font-size: 12pt; color: black; font-family: 宋体;">，</span> <span style="font-size: 12pt; color: black; font-family: 宋体;">绿色由</span><span style="font-size: 12pt; color: black; font-family: 宋体;">C++</span><span style="font-size: 12pt; color: black; font-family: 宋体;">实现</span><span style="font-size: 12pt; color: black; font-family: 宋体;">(</span><span style="font-size: 12pt; color: black; font-family: 宋体;">通常称为</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Native</span><span style="font-size: 12pt; color: black; font-family: 宋体;">层</span><span style="font-size: 12pt; color: black; font-family: 宋体;">)</span><span style="font-size: 12pt; color: black; font-family: 宋体;">，而枣红色为</span><span style="font-size: 12pt; color: black; font-family: 宋体;">C</span><span style="font-size: 12pt; color: black; font-family: 宋体;">实现</span><span style="font-size: 12pt; color: black; font-family: 宋体;">(Kernel </span><span style="font-size: 12pt; color: black; font-family: 宋体;">层</span><span style="font-size: 12pt; color: black; font-family: 宋体;">).</span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"><span style="font-size: 12pt; color: black; font-family: 宋体;">2) HAL libraries</span><span style="font-size: 12pt; color: black; font-family: 宋体;">为</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Mediatek</span><span style="font-size: 12pt; color: black; font-family: 宋体;">在</span><span style="font-size: 12pt; color: black; font-family: 宋体;">HAL</span><span style="font-size: 12pt; color: black; font-family: 宋体;">层的实现</span><span style="font-size: 12pt; color: black; font-family: 宋体;">,</span><span style="font-size: 12pt; color: black; font-family: 宋体;">主要分</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera HAL</span><span style="font-size: 12pt; color: black; font-family: 宋体;">和</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera Core</span><span style="font-size: 12pt; color: black; font-family: 宋体;">两大部分</span><span style="font-size: 12pt; color: black; font-family: 宋体;">.Camera HAL</span><span style="font-size: 12pt; color: black; font-family: 宋体;">衔接</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera Service</span><span style="font-size: 12pt; color: black; font-family: 宋体;">并响应它的需求</span><span style="font-size: 12pt; color: black; font-family: 宋体;">,</span><span style="font-size: 12pt; color: black; font-family: 宋体;">实现各个</span><span style="font-size: 12pt; color: black; font-family: 宋体;">feature</span><span style="font-size: 12pt; color: black; font-family: 宋体;">的</span><span style="font-size: 12pt; color: black; font-family: 宋体;">scenario; </span><span style="font-size: 12pt; color: black; font-family: 宋体;">而</span><span style="font-size: 12pt; color: black; font-family: 宋体;">Camera Core</span><span style="font-size: 12pt; color: black; font-family: 宋体;">提供平台一些通用的数据流控制接口</span><span style="font-size: 12pt; color: black; font-family: 宋体;">. </span></p><p style="margin: 0cm 0cm 0pt; text-align: left;"> </p><ol start="3"><li style="margin: 0cm 0cm 0pt; text-align: left;"><span style="background: yellow; color: black;"></span><span style="background: yellow; color: black; font-family: 宋体;">最后这部分为</span><span style="background: yellow; color: black;">Camera</span><span style="background: yellow; color: black; font-family: 宋体;">的数据流简要介绍</span></li></ol><img alt="camera数据流" src="https://onlinesso.mediatek.com/UploadedPirctures/6353272271144301291077468185%E6%96%B0%E5%9B%BE%E7%89%87%281%29.png"></img><p style="margin: 0cm 0cm 0pt;"><span style="color: black;"><span style="color: black; font-family: 宋体;"><span style="color: black;"><span style="color: black;"><span style="font-size: 12pt; color: black; font-family: 宋体;">说明： </span></span></span></span></span></p><p style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; color: black; font-family: 宋体;">1) TG(Timing Generate):</span><span style="font-size: 12pt; color: black; font-family: 宋体;">从<span>sensor</span>获取数据，并送给<span>ISP</span>处理<span>.</span></span></p><p style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; color: black; font-family: 宋体;">2) Platform Data Processor: </span><span style="font-size: 12pt; color: black; font-family: 宋体;">包括平台在后端对图像数据进行<span>resize</span>、<span>rotate</span>、<span>flip</span>、<span>format convert</span>等处理<span>.</span>它可以同时有两个<span>buffer</span>输出<span>.</span></span></p><p style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; color: black; font-family: 宋体;"><span>   </span></span><span style="font-size: 12pt; color: black; font-family: 宋体;">当<span>normal preview</span>时，<span>port1</span>输出给<span>display</span>，<span>port2</span>输出给<span>face detection</span>或者<span>app preview callback</span></span></p><p style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; color: black; font-family: 宋体;"><span>   </span></span><span style="font-size: 12pt; color: black; font-family: 宋体;">当<span>normal capture</span>时，<span>port1</span>输出大图给<span>jpeg encoder</span>，<span>port2</span>输出小图给回显和<span>thumbnail encode.</span></span></p><p style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; color: black; font-family: 宋体;"><span>   </span></span><span style="font-size: 12pt; color: black; font-family: 宋体;">当<span>video record</span>时，<span>port1</span>输出给<span>display</span>，<span>port2</span>输出给<span>video encoder.</span></span></p><br clear="none"/></div></span>
</div></body></html> 