<html>
<head>
  <title>32 将APK源码放进Android系统源码中编译</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="744"/>
<h1>32 将APK源码放进Android系统源码中编译</h1>

<div>
<span><div><span style="font-size: 16px;">1 将APK的工程，（主要是下面几个文件夹，有些工程没有libs，有些工程没有assets；</span></div><div><span style="font-size: 16px;">需要自己添加的是Android.mk 和CleanSpec.mk）</span></div><div><span style="font-size: 16px;">放到源码某目录，这里放到<b>packages/apps/</b> 下</span></div><div><span style="font-size: 16px;"><img src="32 将APK源码放进Android系统源码中编译_files/Image.png" type="image/png" style="height: auto;"/></span></div><div><span style="font-size: 16px;">2 重点是Android.mk文件</span></div><div><font size="4">Android.mk 注释以#开头</font></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">libs文件夹：</span></div><div><img src="32 将APK源码放进Android系统源码中编译_files/Image [1].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 16px;">这里贴上文件内容：</span></div><div><span style="font-size: 16px;">#--------------------------------------------------------------------------------------------------</span></div><div><span style="font-size: 16px;"><span style="color: rgb(26, 173, 224);">LOCAL_PATH</span> := $(call my-dir)   #设置</span><span style="font-size: 16px;">LOCAL_PATH变量为当前目录</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">#Build .so  编译libs/下的so库</span></div><div><span style="font-size: 16px;">include $(CLEAR_VARS)               <span style="color: rgb(65, 173, 28);">#清空部分变量，因为下面要重新赋值，使用</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(26, 173, 224);">LOCAL_MODULE</span> := libmsc          <span style="color: rgb(77, 206, 29);">#模块名</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(26, 173, 224);">LOCAL_SRC_FILES_64</span> := libs/arm64-v8a/libmsc.so     <span style="color: rgb(77, 206, 29);">#源文件</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(30, 204, 255);">LOCAL_MULTILIB</span> := 64     <span style="color: rgb(77, 206, 29);">#可选64位、32位、both，根据自己的so库来定</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(26, 173, 224);">LOCAL_MODULE_CLASS</span> := SHARED_LIBRARIES    <span style="color: rgb(77, 206, 29);">     #编译为共享库</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(26, 173, 224);">LOCAL_MODULE_SUFFIX</span> := .so     <span style="color: rgb(77, 206, 29);">#模块后缀</span></span></div><div><span style="font-size: 16px;"><span style="color: rgb(229, 0, 255);">include</span> $(<span style="color: rgb(26, 173, 224);">BUILD_PREBUILT</span>)           <span style="color: rgb(77, 206, 29);">#调用编译，提前编译，比apk编译早</span></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">include $(CLEAR_VARS)</span></div><div><span style="font-size: 16px;">LOCAL_MODULE := libeasemob_jni</span></div><div><span style="font-size: 16px;">LOCAL_SRC_FILES_64 := libs/arm64-v8a/libeasemob_jni.so</span></div><div><span style="font-size: 16px;">LOCAL_MULTILIB := 64</span></div><div><span style="font-size: 16px;">LOCAL_MODULE_CLASS := SHARED_LIBRARIES</span></div><div><span style="font-size: 16px;">LOCAL_MODULE_SUFFIX := .so</span></div><div><span style="font-size: 16px;">include $(BUILD_PREBUILT)</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">include $(CLEAR_VARS)</span></div><div><span style="font-size: 16px;">LOCAL_MODULE := libeasemobservice</span></div><div><span style="font-size: 16px;">LOCAL_SRC_FILES_64 := libs/arm64-v8a/libeasemobservice.so</span></div><div><span style="font-size: 16px;">LOCAL_MULTILIB := 64</span></div><div><span style="font-size: 16px;">LOCAL_MODULE_CLASS := SHARED_LIBRARIES</span></div><div><span style="font-size: 16px;">LOCAL_MODULE_SUFFIX := .so</span></div><div><span style="font-size: 16px;">include $(BUILD_PREBUILT)</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">include $(CLEAR_VARS)</span></div><div><span style="font-size: 16px;">LOCAL_MODULE := librobotvideo</span></div><div><span style="font-size: 16px;">LOCAL_SRC_FILES_64 := libs/arm64-v8a/librobotvideo.so</span></div><div><span style="font-size: 16px;">LOCAL_MULTILIB := 64</span></div><div><span style="font-size: 16px;">LOCAL_MODULE_CLASS := SHARED_LIBRARIES</span></div><div><span style="font-size: 16px;">LOCAL_MODULE_SUFFIX := .so</span></div><div><span style="font-size: 16px;">include $(BUILD_PREBUILT)</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">#-----------------------------------------------------</span></div><div><span style="font-size: 16px;">#Build apk    编译APK</span></div><div><span style="font-size: 16px;">include $(CLEAR_VARS)</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">LOCAL_MODULE_TAGS := optional</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">LOCAL_PACKAGE_NAME := YYDRobotVideo             <span style="color: rgb(77, 206, 29);">#编译的apk名，与文件夹名相同    </span>        </span></div><div><span style="font-size: 16px;">LOCAL_SRC_FILES := $(call all-java-files-under, src)               <span style="color: rgb(77, 206, 29);">#src的目录</span></span></div><div><span style="font-size: 16px;">LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res                     <span style="color: rgb(77, 206, 29);">#res的目录</span></span></div><div><span style="font-size: 16px;">LOCAL_ASSET_DIR := $(LOCAL_PATH)/assets                        <span style="color: rgb(77, 206, 29);">#assets的目录</span></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">LOCAL_STATIC_JAVA_LIBRARIES := \                         <span style="color: rgb(77, 206, 29);">#添加jar库，libs中所包含的</span></span></div><div><span style="font-size: 16px;">    android-support-v4 \</span></div><div><span style="font-size: 16px;">    Msc \</span></div><div><span style="font-size: 16px;">    easemobchat_2.2.4 \</span></div><div><span style="font-size: 16px;">    gson-2.3.1 \</span></div><div><span style="font-size: 16px;">    netty-all-5.0.0.Alpha2</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="color: rgb(77, 206, 29);"><span style="font-size: 16px;">#添加so库的调用</span></span></div><div><span style="font-size: 16px;">LOCAL_JNI_SHARED_LIBRARIES += libmsc libeasemob_jni libeasemobservice librobotvideo</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">LOCAL_MULTILIB := 64     <span style="color: rgb(77, 206, 29);">#编译为64位格式</span></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">LOCAL_PROGUARD_ENABLED := disabled</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">include $(BUILD_PACKAGE)    <span style="color: rgb(77, 206, 29);"> #调用apk编译</span></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">include $(CLEAR_VARS)</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := \          <span style="color: rgb(77, 206, 29);">#对于jar需要提前编译，</span></span><span style="color: rgb(77, 206, 29);"><span style="font-size: 16px;">PREBUILT</span></span></div><div><span style="font-size: 16px;">    Msc:libs/Msc.jar \</span></div><div><span style="font-size: 16px;">    easemobchat_2.2.4:libs/easemobchat_2.2.4.jar \</span></div><div><span style="font-size: 16px;">    gson-2.3.1:libs/gson-2.3.1.jar \</span></div><div><span style="font-size: 16px;">    netty-all-5.0.0.Alpha2:libs/netty-all-5.0.0.Alpha2.jar</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">include $(BUILD_MULTI_PREBUILT)</span></div><div><span style="font-size: 16px;">#--------------------------------------------------------------------------------------------------</span></div><div><br/></div><div><span style="font-size: 16px;">3 需在 device/mediatek/common/device.mk 中添加这个工程的路径</span></div><div><br/></div><div><img src="32 将APK源码放进Android系统源码中编译_files/Image [2].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;">(如有错，请直接修改)</span></span></div></span>
</div></body></html> 