<html>
<head>
  <title>3Building the System</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1182"/>
<h1>3Building the System</h1>

<div>
<span><div style="padding: 2.2em 0px 0.2em; color: rgb(34, 34, 34); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px auto; width: 940px; clear: both; transition: all 0.25s ease-out; max-width: 940px; height: 41px; border-bottom-width: 1px; border-bottom-style: solid; border-color: rgb(204, 204, 204); position: relative;"><div style="display: inline; float: left; margin: -3px 30px 0px 0px; width: 140px; padding-right: 0px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204);"><a href="http://source.android.com/index.html" style="color: rgb(37, 138, 175); text-decoration: none;"><img src="3Building the System_files/Image.png" type="image/png" alt="Android Open Source Project" height="25" style="border: 0px; vertical-align: middle; max-width: 100%; height: auto;" width="123"/></a></div><ul style="margin: -2px 10px 0px 0px; padding: 0px; display: inline; float: left; width: 520px; list-style-type: none;"><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/source/index.html" style="color: rgb(51, 181, 229); text-decoration: none; font-size: 16px;">Source</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/devices/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Devices</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/security/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Security</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/compatibility/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Compatibility</a></li></ul><div style="position: absolute; right: 6px; top: -9px; width: 40px; height: 35px; z-index: 99; overflow: hidden; opacity: 0; transform-origin: 100% 0% 0px; transition-property: -webkit-opacity; transition-duration: 0.25s; transition-timing-function: ease;"><div style="width: 228px; padding: 10px 20px 0px; background: url(http://source.android.com/assets/images/more_mid.png) repeat-y;"><div style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); font-weight: bold;">Android Sites</div><ul style="margin: 10px 10px 20px 0px; padding: 0px;"><li><a style="color: rgb(34, 34, 34) !important;">Android Open Source Project</a><a href="http://www.android.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android.com</a><a href="http://developer.android.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android Developers</a></li></ul><br/></div></div></div></div><div style="margin: 0px auto; width: 940px; clear: both; color: rgb(34, 34, 34); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="display: inline; float: left; margin-left: 0px; margin-right: 10px; width: 220px; min-height: 5px; margin-bottom: 1px; overflow: hidden;"><div style="outline: none; width: 220px; margin: 20px 0px 0px; overflow: hidden; padding: 0px; height: 922px;"><div style="overflow: hidden; position: relative; width: 220px; height: 922px;"><div style="position: absolute; overflow: hidden; width: 220px; padding: 0px; top: 0px;"><ul style="margin: 0px; padding: 0px 0px 30px; width: 216px;"><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/index.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Overview</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px; background: rgba(0, 0, 0, 0.0470588);"><a href="http://source.android.com/source/requirements.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Downloading and Building</a></div></li><li style="list-style: none; display: inline"><ul style="margin: 0px; padding: 0px; display: block; overflow: hidden;"><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/initializing.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Establishing a Build Environment</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/downloading.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Downloading the Source</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/building.html" style="color: rgb(0, 153, 204); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Building the System</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/jack.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Compiling with Jack</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/devices.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Selecting Devices</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/running.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Running Builds</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/building-kernels.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Building Kernels</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px 0px 5px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/known-issues.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Known Issues</a></li></ul></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/developing.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Developing</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/contributing.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Contributing</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/community.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Community</a></div></li></ul></div></div></div></div><div style="display: inline; float: left; margin-left: 10px; margin-right: 0px; width: 700px;"><h1 style="color: rgb(51, 51, 51); font-size: 34px; margin: 36px 0px 27px; padding: 0px 0px 10px; font-weight: 300;">Building the System</h1><div><div style="float: right; clear: right; margin: -27px 0px 0px 20px; padding: 0px 0px 20px;"><div style="font-size: 13px; width: 238px; border: 1px solid rgb(204, 204, 204); float: right;"><h2 style="color: rgb(51, 51, 51); font-size: inherit; margin: 10px 15px; padding: 0px; font-weight: 300; text-transform: uppercase; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: gainsboro;">IN THIS DOCUMENT</h2><ol style="margin: 0px 15px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#initialize" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Set up environment</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#choose-a-target" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Choose a Target</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#build-the-code" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Build the code</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#run-it" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Run It!</a><ol style="margin: 3px 0px 3px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#flash-a-device" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Flash a Device</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#emulate-an-android-device" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Emulate an Android Device</a></li></ol></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#using-ccache" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Using ccache</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#troubleshooting-common-build-errors" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Troubleshooting Common Build Errors</a><ol style="margin: 3px 0px 3px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#wrong-java-version" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Wrong Java Version</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#python-version-3" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Python Version 3</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#case-insensitive-filesystem" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Case Insensitive Filesystem</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/building.html#no-usb-permission" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">No USB Permission</a></li></ol></li></ol></div></div><p style="margin: 0px 0px 15px;">The following instructions to build the Android source tree apply to all branches, including <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code>. The basic sequence of build commands is as follows:</p><p style="margin: 0px 0px 15px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(37, 138, 175);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Note:</strong> If you're building Android 6.0 or later, please see <a href="http://source.android.com/source/jack.html" style="color: rgb(37, 138, 175); text-decoration: none;">Compiling with Jack</a> for information on this new default toolchain.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Set up environment</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">Initialize the environment with the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">envsetup.sh</code> script. Note that replacing <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">source</code> with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.</code> (a single dot) saves a few characters, and the short form is more commonly used in documentation.</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ source build</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">envsetup</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);">sh<br/></span></code></pre><p style="margin: 0px 0px 15px;">or</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ </span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);"> build</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">envsetup</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);">sh<br/></span></code></pre><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Choose a Target</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">Choose which target to build with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">lunch</code>. The exact configuration can be passed as an argument. For example, the following command:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ lunch aosp_arm</span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">eng<br/></span></code></pre><p style="margin: 0px 0px 15px;">refers to a complete build for the emulator, with all debugging enabled.</p><p style="margin: 0px 0px 15px;">If run with no arguments <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">lunch</code> will prompt you to choose a target from the menu.</p><p style="margin: 0px 0px 15px;">All build targets take the form <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">BUILD-BUILDTYPE</code>, where the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">BUILD</code> is a codename referring to the particular feature combination.</p><p style="margin: 0px 0px 15px;">The BUILDTYPE is one of the following:</p><table style="font-size: 1em; margin: 0.5em 1em 1em 0px; border-collapse: collapse; border-spacing: 0px; border: 0px; width: 699px; background-color: rgb(247, 247, 247);"><thead><tr><th style="padding: 4px 12px; vertical-align: top; text-align: left; color: rgb(255, 255, 255); border: 1px solid rgb(221, 221, 221); font-weight: normal; background-color: rgb(153, 153, 153);">Buildtype</th><th style="padding: 4px 12px; vertical-align: top; text-align: left; color: rgb(255, 255, 255); border: 1px solid rgb(221, 221, 221); font-weight: normal; background-color: rgb(153, 153, 153);">Use</th></tr></thead><tbody><tr><td style="padding: 4px 12px; vertical-align: top; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: inherit;">user</td><td style="padding: 4px 12px; vertical-align: top; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: inherit;">limited access; suited for production</td></tr><tr><td style="padding: 4px 12px; vertical-align: top; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: inherit;">userdebug</td><td style="padding: 4px 12px; vertical-align: top; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: inherit;">like &quot;user&quot; but with root access and debuggability; preferred for debugging</td></tr><tr><td style="padding: 4px 12px; vertical-align: top; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: inherit;">eng</td><td style="padding: 4px 12px; vertical-align: top; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: inherit;">development configuration with additional debugging tools</td></tr></tbody></table><p style="margin: 0px 0px 15px;">For more information about building for and running on actual hardware, see <a href="http://source.android.com/source/running.html" style="color: rgb(37, 138, 175); text-decoration: none;">Running Builds</a>.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Build the code</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">Build everything with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make</code>. GNU make can handle parallel tasks with a <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">-jN</code> argument, and it's common to use a number of tasks N that's between 1 and 2 times the number of hardware threads on the computer being used for the build. For example, on a dual-E5520 machine (2 CPUs, 4 cores per CPU, 2 threads per core), the fastest builds are made with commands between <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make -j16</code> and <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make -j32</code>.</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ make </span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">j4<br/></span></code></pre><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Run It!</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">You can either run your build on an emulator or flash it on a device. Please note that you have already selected your build target with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">lunch</code>, and it is unlikely at best to run on a different target than it was built for.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Flash a Device</h3><p style="margin: 0px 0px 15px;">To flash a device, you will need to use <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">fastboot</code>, which should be included in your path after a successful build. Place the device in fastboot mode either manually by holding the appropriate key combination at boot, or from the shell with</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ adb reboot bootloader<br/></span></code></pre><p style="margin: 0px 0px 15px;">Once the device is in fastboot mode, run</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ fastboot flashall </span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">w<br/></span></code></pre><p style="margin: 0px 0px 15px;">The <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">-w</code> option wipes the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/data</code> partition on the device; this is useful for your first time flashing a particular device but is otherwise unnecessary.</p><p style="margin: 0px 0px 15px;">For more information about building for and running on actual hardware, see <a href="http://source.android.com/source/running.html" style="color: rgb(37, 138, 175); text-decoration: none;">Running Builds</a>.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Emulate an Android Device</h3><p style="margin: 0px 0px 15px;">The emulator is added to your path automatically by the build process. To run the emulator, type</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ emulator<br/></span></code></pre><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Using ccache</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">ccache is a compiler cache for C and C++ that can help make builds faster. In the root of the source tree, do the following:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ </span><span style="color: rgb(0, 0, 136);">export</span><span style="color: rgb(0, 0, 0);"> USE_CCACHE</span><span style="color: rgb(102, 102, 0);">=</span><span style="color: rgb(0, 102, 102);">1</span><span style="color: rgb(0, 0, 0);"><br/>$ </span><span style="color: rgb(0, 0, 136);">export</span><span style="color: rgb(0, 0, 0);"> CCACHE_DIR</span><span style="color: rgb(102, 102, 0);">=</span><span style="color: rgb(0, 136, 0);">/&lt;path_of_your_choice&gt;/</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);">ccache<br/>$ prebuilts</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">misc</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">linux</span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">x86</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">ccache</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">ccache </span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">M </span><span style="color: rgb(0, 102, 102);">50G</span><span style="color: rgb(0, 0, 0);"><br/></span></code></pre><p style="margin: 0px 0px 15px;">The suggested cache size is 50-100G.</p><p style="margin: 0px 0px 15px;">On Linux, you can watch ccache being used by doing the following:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ watch </span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">n1 </span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">d prebuilts</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">misc</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">linux</span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">x86</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">ccache</span><span style="color: rgb(102, 102, 0);">/</span><span style="color: rgb(0, 0, 0);">ccache </span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">s<br/></span></code></pre><p style="margin: 0px 0px 15px;">On Mac OS, you should replace <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">linux-x86</code> with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">darwin-x86</code>.</p><p style="margin: 0px 0px 15px;">When using Ice Cream Sandwich (4.0.x) or older, you should replace <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">prebuilts/misc</code> with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">prebuilt</code>.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Troubleshooting Common Build Errors</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Wrong Java Version</h3><p style="margin: 0px 0px 15px;">If you are attempting to build a version of Android inconsistent with your version of Java, <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make</code> will abort with a message such as</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(102, 102, 0);">************************************************************</span><span style="color: rgb(0, 0, 0);"><br/></span><span style="color: rgb(102, 0, 102);">You</span><span style="color: rgb(0, 0, 0);"> are attempting to build </span><span style="color: rgb(0, 0, 136);">with</span><span style="color: rgb(0, 0, 0);"> the incorrect version<br/>of java</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);"><br/><br/></span><span style="color: rgb(102, 0, 102);">Your</span><span style="color: rgb(0, 0, 0);"> version </span><span style="color: rgb(0, 0, 136);">is</span><span style="color: rgb(102, 102, 0);">:</span><span style="color: rgb(0, 0, 0);"> WRONG_VERSION</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);"><br/></span><span style="color: rgb(102, 0, 102);">The</span><span style="color: rgb(0, 0, 0);"> correct version </span><span style="color: rgb(0, 0, 136);">is</span><span style="color: rgb(102, 102, 0);">:</span><span style="color: rgb(0, 0, 0);"> RIGHT_VERSION</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);"><br/><br/></span><span style="color: rgb(102, 0, 102);">Please</span><span style="color: rgb(0, 0, 0);"> follow the machine setup instructions at<br/>    https</span><span style="color: rgb(102, 102, 0);">:</span><span style="color: rgb(136, 0, 0);">//source.android.com/source/download.html</span><span style="color: rgb(0, 0, 0);"><br/></span><span style="color: rgb(102, 102, 0);">************************************************************</span><span style="color: rgb(0, 0, 0);"><br/></span></code></pre><p style="margin: 0px 0px 15px;">This may be caused by:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Failing to install the correct JDK as specified in <a href="http://source.android.com/source/initializing.html" style="color: rgb(37, 138, 175); text-decoration: none;">Initializing the Build Environment</a>.</p></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Another JDK previously installed appearing in your path. Prepend the correct JDK to the beginning of your PATH or remove the problematic JDK.</p></li></ul><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Python Version 3</h3><p style="margin: 0px 0px 15px;">Repo is built on particular functionality from Python 2.x and is unfortunately incompatible with Python 3. In order to use repo, please install Python 2.x:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(0, 0, 0);">$ apt</span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 136);">get</span><span style="color: rgb(0, 0, 0);"> install python<br/></span></code></pre><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Case Insensitive Filesystem</h3><p style="margin: 0px 0px 15px;">If you are building on an HFS filesystem on Mac OS, you may encounter an error such as</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"><span style="color: rgb(102, 102, 0);">************************************************************</span><span style="color: rgb(0, 0, 0);"><br/></span><span style="color: rgb(102, 0, 102);">You</span><span style="color: rgb(0, 0, 0);"> are building on a </span><span style="color: rgb(0, 0, 136);">case</span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">insensitive filesystem</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);"><br/></span><span style="color: rgb(102, 0, 102);">Please</span><span style="color: rgb(0, 0, 0);"> move your source tree to a </span><span style="color: rgb(0, 0, 136);">case</span><span style="color: rgb(102, 102, 0);">-</span><span style="color: rgb(0, 0, 0);">sensitive filesystem</span><span style="color: rgb(102, 102, 0);">.</span><span style="color: rgb(0, 0, 0);"><br/></span><span style="color: rgb(102, 102, 0);">************************************************************</span><span style="color: rgb(0, 0, 0);"><br/></span></code></pre><p style="margin: 0px 0px 15px;">Please follow the instructions in <a href="http://source.android.com/source/initializing.html" style="color: rgb(37, 138, 175); text-decoration: none;">Initializing the Build Environment</a> for creating a case-sensitive disk image.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">No USB Permission</h3><p style="margin: 0px 0px 15px;">On most Linux systems, unprivileged users cannot access USB ports by default. If you see a permission denied error, follow the instructions <a href="http://source.android.com/source/initializing.html" style="color: rgb(37, 138, 175); text-decoration: none;">Initializing the Build Environment</a> for configuring USB access.</p><p style="margin: 0px 0px 15px;">If adb was already running and cannot connect to the device after getting those rules set up, it can be killed with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">adb kill-server</code>. That will cause adb to restart with the new configuration.</p></div><div style="margin: 10px auto 0px; width: auto; clear: both; font-size: 11px; color: rgb(153, 153, 153); padding: 15px 0px;"><div style="margin: 0px 0px 0px 10px; font-size: 14px; float: right !important;"><a href="http://source.android.com/source/building.html#" style="border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; border-radius: 2px; cursor: pointer; display: inline-block; border: 1px solid rgb(57, 144, 171); color: rgb(255, 255, 255); margin-right: 16px; font-weight: 400; min-width: 54px; outline: 0px; padding: 8px 15px; text-align: center; text-decoration: none; background-image: -webkit-linear-gradient(top, rgb(47, 173, 219), rgb(0, 153, 204)); background-color: rgb(0, 153, 204);">Site Feedback</a></div><div>Except as noted, this content is licensed under <a href="http://creativecommons.org/licenses/by/2.5/" style="color: rgb(37, 138, 175); text-decoration: none;">Creative Commons Attribution 2.5</a>. For details and restrictions, see the <a href="http://source.android.com/license.html" style="color: rgb(37, 138, 175); text-decoration: none;">Content License</a>.</div><div style="margin: 0px 0px 15px;"><div><a href="http://source.android.com/source/index.html" style="color: rgb(37, 138, 175); text-decoration: none;">About Android</a>  |  <a href="http://source.android.com/source/community.html" style="color: rgb(37, 138, 175); text-decoration: none;">Community</a>  |  <a href="http://source.android.com/legal.html" style="color: rgb(37, 138, 175); text-decoration: none;">Legal</a>  | </div></div></div></div></div></span>
</div></body></html> 