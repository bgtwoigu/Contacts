<html>
<head>
  <title>68 版本发布脚本-mt8735</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5407"/>
<h1>68 版本发布脚本-mt8735</h1>

<div>
<span><div><span style="color: rgb(54, 101, 238);">1 获取当前分支，并更新代码到最新</span></div><div><span style="color: rgb(54, 101, 238);">2 改写版本号</span></div><div><span style="color: rgb(54, 101, 238);">3 是否clean编译</span></div><div><span style="color: rgb(54, 101, 238);">4 source build/envsetup.sh</span></div><div><span style="color: rgb(54, 101, 238);">5 lunch</span></div><div><span style="color: rgb(54, 101, 238);">6 make -j8 2&gt;&amp;1 | tee build.log</span></div><div><span style="color: rgb(54, 101, 238);">7 打包系统</span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><span style="color: rgb(65, 173, 28);">#!/bin/bash</span></div><div><br/></div><div>#prepare 0: Get the latest source code</div><div>echo &quot;&gt;&gt;&gt; git status&quot;</div><div>Branch=`git status | sed -n '1p' | awk '{print $4}'`</div><div>echo &quot;&gt;&gt;&gt; git pull origin $Branch&quot;</div><div>git pull origin $Branch</div><div><br/></div><div>#modify  versionNumber build/tools/buildinfo.sh</div><div>changeBuildinfo(){</div><div>    read -p &quot;&gt;&gt;&gt; Please input new version number (like \&quot;YYD_Y20_A_V1R015\&quot;): &quot; VersionNumber</div><div>    if [ -n &quot;$VersionNumber&quot; ];then</div><div>        echo -e &quot;\e[0;31;1m &gt;&gt;&gt; You are changing version number to $VersionNumber \033[0m&quot;</div><div>    else</div><div>        echo &quot;&gt;&gt;&gt; Please input new version number&quot;</div><div>        read -p &quot;&gt;&gt;&gt; new version: &quot; VersionNumber</div><div>    fi</div><div>    OldVersionNumber=`grep &quot;ro.wisky.build_number_one&quot; build/tools/buildinfo.sh`</div><div>    newVersion=&quot;echo \&quot;ro.wisky.build_number_one=$VersionNumber\&quot;&quot;</div><div>    sed -i &quot;s/$OldVersionNumber/$newVersion/&quot; build/tools/buildinfo.sh</div><div>}</div><div><br/></div><div>#modify new versionNumber device/wisky/wisky8735_3g_h/system.prop</div><div>changeSystemProp(){</div><div>    read -p &quot;&gt;&gt;&gt; Please input new version number (like \&quot;YOS2.21.015\&quot;): &quot; SecVersionNumber</div><div>    if [ -n &quot;$SecVersionNumber&quot; ];then</div><div>        echo -e &quot;\e[0;31;1m &gt;&gt;&gt; You are changing version number to $SecVersionNumber \033[0m&quot;</div><div>    else</div><div>        echo &quot;&gt;&gt;&gt; Please input new version number&quot;</div><div>        read -p &quot;&gt;&gt;&gt; &quot; SecVersionNumber</div><div>    fi</div><div>    SecOldVersionNumber=`grep &quot;robot.os_version&quot; device/wisky/wisky8735_3g_h/system.prop`</div><div>    SecNewVersion=&quot;robot.os_version=$SecVersionNumber&quot;</div><div>    sed -i &quot;s/$SecOldVersionNumber/$SecNewVersion/&quot; device/wisky/wisky8735_3g_h/system.prop</div><div>}</div><div><br/></div><div>#build prepare: All clean or delete something</div><div>isCleanAll(){</div><div>    PackagePath=&quot;out/target/product/wisky8735_3g_h/&quot;</div><div>    echo -e &quot;&gt;&gt;&gt; Please input \e[0;31;1m\&quot;y\&quot; to make clean\033[0m or other key to delete some apps&quot;</div><div>    read -p &quot;&gt;&gt;&gt; is clean? : &quot; IsClean</div><div>    if [ &quot;$IsClean&quot; = &quot;y&quot; ];then</div><div>        make clean</div><div>    else</div><div>        rm -rf &quot;$PackagePath&quot;system/</div><div>        rm -rf &quot;$PackagePath&quot;obj/APPS/</div><div>        #rm -rf &quot;out/target/common/obj/APPS/&quot;</div><div>        #rm -rf &quot;out/target/common/obj/JAVA_LIBRARIES/&quot;</div><div>    fi</div><div>}</div><div><br/></div><div>buildSystem(){</div><div>    echo &quot;&gt;&gt;&gt; source build/envsetup.sh&quot;</div><div>    . ./build/envsetup.sh</div><div><br/></div><div>    `echo 1 | lunch &gt; lunch.txt`</div><div>    if [ -f lunch.txt ];then</div><div>        Num=`grep -w &quot;full_wisky8735_3g_h-user&quot; lunch.txt | cut -b 6-7`</div><div>        echo &quot;&gt;&gt;&gt; \&quot;lunch $Num\&quot; (full_wisky8735_3g_h-user)&quot;</div><div>        lunch &quot;$Num&quot;</div><div>    else</div><div>        echo -e &quot;\e[0;31;1m &gt;&gt;&gt; lunch.txt: No such a file or file not found \033[0m&quot;</div><div>        exit 0</div><div>    fi</div><div><br/></div><div>    echo -e &quot;\e[0;34;1m &gt;&gt;&gt; make -j8 2&gt;&amp;1 | tee build.log\033[0m&quot;</div><div>    if [ -f build.log ];then</div><div>        rm -rf build.log</div><div>    fi</div><div>    make -j8 2&gt;&amp;1 | tee build.log</div><div><br/></div><div>    if [ -f build.log ];then</div><div>        result=`grep &quot;make completed successfully&quot; build.log`</div><div>        if [ -n &quot;$result&quot; ];then</div><div>            packSystem</div><div>        else </div><div>            echo -e &quot;\e[0;31;1m &gt;&gt;&gt; Failed \033[0m&quot;</div><div>        fi</div><div>    fi</div><div>}</div><div><br/></div><div>#build finished and packing system as *.tar.gz</div><div>packSystem(){ </div><div>    mkdir &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;android-info.txt &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;appsboot.mbn &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;appsboot.raw &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;boot.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;cache.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;clean_steps.mk &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;custom_build_verno &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;installed-files.txt &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;kernel &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;lk.bin &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;logo.bin &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;MT6735_Android_scatter.txt &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;ota_scatter.txt &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;preloader_wisky8735_3g_h.bin &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;previous_build_config.mk &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;ramdisk.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;ramdisk-recovery.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;recovery.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;secro.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;system.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;trustzone.bin &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;userdata.img &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;obj/CGEN/AP* &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;obj/ETC/BPLGUInfoCustomAppSrcP_MT6735_S00_MOLY_LR9_W1444_MD_LWTG_CMCC_MP_V6_1_ltg_n_intermediates/* &quot;$VersionNumber&quot;</div><div>    cp &quot;$PackagePath&quot;obj/ETC/BPLGUInfoCustomAppSrcP_MT6735_S00_MOLY_LR9_W1444_MD_LWTG_CMCC_MP_V6_1_lwg_n_intermediates/* &quot;$VersionNumber&quot;</div><div>    tar czf &quot;$VersionNumber&quot;.tar.gz &quot;$VersionNumber&quot;</div><div>    echo -e &quot;\e[0;32;1m &gt;&gt;&gt; Completed \033[0m&quot;</div><div>}</div><div><br/></div><div>#build prepare: All clean or delete something</div><div>isCleanAll</div><div><br/></div><div>#modify  versionNumber build/tools/buildinfo.sh</div><div>changeBuildinfo</div><div><br/></div><div>#modify new versionNumber device/wisky/wisky8735_3g_h/system.prop</div><div>changeSystemProp</div><div><br/></div><div>#Start to build system</div><div>buildSystem</div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 