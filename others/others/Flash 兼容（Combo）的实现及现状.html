<html>
<head>
  <title>Flash 兼容（Combo）的实现及现状</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="A20A072C-3573-4EC8-B3CF-3C90E272CC71"/>
  <meta name="application-data:corenote-localUUID" content="1E965561-96C0-48DA-ABC8-DAA004CF01ED"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2362"/>
<h1>Flash 兼容（Combo）的实现及现状</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
<span style="-evernote-last-insertion-point:true;"></span>
<table border="0" style="font-family: verdana, Helvetica, sans-serif !important;">
<tbody>
<tr>
<td>
<div style="border-bottom-color: rgb(196, 196, 196); border-bottom-width: 1px; border-bottom-style: solid; overflow: hidden; font-size: 12px;">
<div style="border-left-color: rgb(196, 196, 196); border-left-width: 1px; border-left-style: solid; padding: 10px 15px 20px; background-color: rgb(247, 247, 247); border-right-color: rgb(196, 196, 196); border-right-width: 1px; border-right-style: solid; overflow: hidden; word-break: break-all;">
<div style="visibility: visible;">
<div style="visibility: visible;">
<div style="visibility: visible;">
<p style="line-height: 32px; word-break: break-all;"><font size="3"><span style="line-height: 36px; color: rgb(51, 51, 51); font-size: 13.5pt;"><font size="4">[KEYWORDS]</font></span></font></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51);">Flash Combo；eMMC Combo；Flash兼容</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="line-height: 36px; color: rgb(51, 51, 51); font-size: 13.5pt;">[DESCRIPTION]</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">    </span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Flash combo</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">可以简单分为两个部分，一个是</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">DRAM</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">combo</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，同一份</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">load</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中兼容若干颗</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">ID/Type/Size</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">不同的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，在开机过程</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">preloader</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">阶段，正确识别主板上使用的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，进行</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">EMI</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">时序的配置；另一种是</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">ROM</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">combo</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，根据</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">ROM</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">类型，可以分为</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">nand</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，对于</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，因为其自带</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">controller</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，且具有相对固定的分区格式：</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot2</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">combo</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的目的是将同一份</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">load</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">正确下载到不同分区情况的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上；</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">nand flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上没有</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">controller</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，需要正确的时序进行初始化，且不同</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">page size</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">nand flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，其存储方式不同，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">combo</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的目的是同一份</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">load</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">可以实现不同</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">page size</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上的正确存取。</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;"> </span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="line-height: 36px; color: rgb(51, 51, 51); font-size: 13.5pt;">[SOLUTION]</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><b><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;">1)<span style="font-weight: normal; font-size: 7pt; line-height: normal;">   </span></span></b><b><span style="color: rgb(0, 32, 96);">DRAM Combo</span></b></p>
<p style="line-height: 32px; word-break: break-all;"><span style="font-size: 12pt;">        </span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">因为</span><span style="font-size: 12pt;">EMI controller</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">设计的原因，不同平台上的处理方式不同，目前</span><span style="font-size: 12pt;">71/72</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">平台上</span><span style="font-size: 12pt;">DRAM</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">的兼容情况及实现请参考</span><span style="line-height: 24px; color: rgb(227, 108, 10); font-size: 9pt;">FAQ11403 </span><span lang="ZH-CN" style="color: rgb(227, 108, 10); font-size: 12pt;" xml:lang="ZH-CN">如何在</span><span style="color: rgb(227, 108, 10); font-size: 12pt;">MT6571/MT6572</span><span lang="ZH-CN" style="color: rgb(227, 108, 10); font-size: 12pt;" xml:lang="ZH-CN">平台上兼容</span><span style="color: rgb(227, 108, 10); font-size: 12pt;">MCP</span><span lang="ZH-CN" style="color: rgb(227, 108, 10); font-size: 12pt;" xml:lang="ZH-CN">，</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">注意：</span><span style="font-size: 12pt;">FlashTool </span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">版本需要更新至</span><span style="font-size: 12pt;"> SP_Flash_Tool_v5.1349.05</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">。</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="font-size: 12pt;">    <span lang="ZH-CN" xml:lang="ZH-CN">其它平台（如</span></span><span style="font-size: 12pt;">82/89/92</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">等）上的</span><span style="font-size: 12pt;">DRAM </span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">兼容分为两种情况：</span><span style="font-size: 12pt;">MCP</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="font-size: 12pt;">Discrete Dram</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">，有如下限制条件：</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(31, 73, 125); font-size: 10pt;">A.<span style="font-size: 7pt; line-height: normal;">    </span></span>MCP<span lang="ZH-CN" xml:lang="ZH-CN">类型的</span>Flash <span lang="ZH-CN" xml:lang="ZH-CN">兼容，</span>Flash ID<span lang="ZH-CN" xml:lang="ZH-CN">必须各不相同；</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(31, 73, 125); font-size: 10pt;">B.<span style="font-size: 7pt; line-height: normal;">    </span></span><span style="line-height: 18.66666603088379px; font-size: 7pt;"> </span>Discrete Flash<span lang="ZH-CN" xml:lang="ZH-CN">和</span>MCP Flash<span lang="ZH-CN" xml:lang="ZH-CN">的</span><span lang="ZH-CN" xml:lang="ZH-CN">兼容，要求</span>Vendor ID<span lang="ZH-CN" xml:lang="ZH-CN">（</span>MemoryDeviceList_MTxxxx.xls<span lang="ZH-CN" xml:lang="ZH-CN">中的</span>MODE_REG5<span lang="ZH-CN" xml:lang="ZH-CN">）各不相同，并且所有兼容的</span>DRAM<span lang="ZH-CN" xml:lang="ZH-CN">的类型（</span>LPDDR2/LPDDR3<span lang="ZH-CN" xml:lang="ZH-CN">）必须相同，如果有</span>PCDDR3<span lang="ZH-CN" xml:lang="ZH-CN">类型的</span>DRAM<span lang="ZH-CN" xml:lang="ZH-CN">，也不可以进行兼容；</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(31, 73, 125); font-size: 10pt;">C.<span style="font-size: 7pt; line-height: normal;">    </span></span><span style="line-height: 18.66666603088379px; font-size: 7pt;"> </span>Discrete Flash<span lang="ZH-CN" xml:lang="ZH-CN">和</span>MCP Flash<span lang="ZH-CN" xml:lang="ZH-CN">的</span><span lang="ZH-CN" xml:lang="ZH-CN">兼容，</span>Discrete eMMC<span lang="ZH-CN" xml:lang="ZH-CN">的</span>Flash ID<span lang="ZH-CN" xml:lang="ZH-CN">不能和</span>MCP<span lang="ZH-CN" xml:lang="ZH-CN">中的</span>Flash ID<span lang="ZH-CN" xml:lang="ZH-CN">相同。</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(31, 73, 125); font-size: 12pt;">        </span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">注意：</span><span style="font-size: 12pt;">Discrete Dram</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">的配置方式是在</span><span style="font-size: 12pt;">custom_MemoryDevice.h</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">中配置</span><span style="font-size: 12pt;">DRAM</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="font-size: 12pt;">part number</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">，软件中没有配置</span><span style="font-size: 12pt;">Discrete eMMC</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">，但是</span><span style="font-size: 12pt;">Discrete eMMC</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">的选用还是要参考</span><span style="font-size: 12pt;">Memory_Validation_List_External_Wxxxx.xlsx</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">中</span><span style="font-size: 12pt;">Discrete eMMC</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">页中的</span><span style="font-size: 12pt;">Flash</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">，因为</span><span style="font-size: 12pt;">eMMC</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">中有</span><span style="font-size: 12pt;">controller</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">，其中有</span><span style="font-size: 12pt;">Firmware</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">，只有选用</span><span style="font-size: 12pt;">xlsx</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">中验证过的</span><span style="font-size: 12pt;">Flash</span><span lang="ZH-CN" style="font-size: 12pt;" xml:lang="ZH-CN">才能保证系统正常工作。</span><span style="color: rgb(51, 51, 51); font-size: 12pt;"> </span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><b><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;">2)<span style="font-weight: normal; font-size: 7pt; line-height: normal;">   </span></span></b><b><span style="color: rgb(0, 32, 96);">ROM Combo</span></b></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">         </span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">对于</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">nand flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">2KB/4KB page size</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的兼容，请参考</span><span style="color: rgb(227, 108, 10); font-size: 12pt;">FAQ07801 NAND Flash 2K</span><span lang="ZH-CN" style="color: rgb(227, 108, 10); font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="color: rgb(227, 108, 10); font-size: 12pt;">4K</span><span lang="ZH-CN" style="color: rgb(227, 108, 10); font-size: 12pt;" xml:lang="ZH-CN">兼容</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">。</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">         </span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">在解释</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">combo</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">之前，先简单介绍一下</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的架构，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上有如下几个分区：</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot2</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，前三个分区通常称为：</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Special Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">。</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">           Linux</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">操作系统在启动过程，规定是从</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中获取</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR image</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的内容，所以</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">及其它的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">image</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">都必须存储在</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">preloader image</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">存储在</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中，如下图所示：</span></p>
<p style="line-height: 32px; word-break: break-all;"></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;"><img src="Flash 兼容（Combo）的实现及现状_files/Image.jpg" type="image/jpeg" alt=""/> </span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">         </span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">因为不同的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot2</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">及</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">RPMB </span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">分区的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">size</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">可能会有所不同，为了满足</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">必须存储在</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中的要求，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MT65</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">92</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">之前的平台的做法是取所有兼容的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">上最大的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Special region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">做为</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">分区的起始地址，比如兼容了三颗</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的存储位置如下图所示：</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;"><img src="Flash 兼容（Combo）的实现及现状_files/Image [1].jpg" type="image/jpeg" alt=""/> </span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot2</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">及</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的值可以查看文件</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MemoryDeviceList_MTxxxx.xls</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">emmc_region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">页，同一</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">part number</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，其</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot2</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">及</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的值是固定的；但是对于</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Discrete eMMC</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的兼容，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">c</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">ustom_MemoryDevice.h</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中配置的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">part number</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">仅表示</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">DRAM</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的型号，所以无法从</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">emmc_region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中获取对应的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">、</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot2</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">及</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，为了处理这种情况，在文件</span><span style="color: rgb(51, 51, 51); font-size: 12pt;"><a href="http://mbr_addr.pl">mbr_addr.pl</a></span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中设定了一个</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的默认值：</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">$MBR_Start_Adress_KB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，这个值需要通过使用</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Flashtool</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">memory test</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">进行确认并修改，如下图：</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;"> <img src="Flash 兼容（Combo）的实现及现状_files/Image [2].jpg" type="image/jpeg" alt=""/></span></p>
<p style="line-height: 32px; word-break: break-all;"><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">最终在编译过程，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;"><a href="http://Ptgen.pl">Ptgen.pl</a></span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">中通过对比</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">max(Boot1+Boot2+RPMB) </span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="color: rgb(51, 51, 51); font-size: 12pt;"> <a href="http://mbr_addr.pl">mbr_addr.pl</a></span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的默认值，将较大的值做为</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的起始地址，实现多个</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">eMMC</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的兼容。但这种兼容方式有如下几点不足之处：</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;">A.<span style="font-size: 7pt; line-height: normal;">    </span></span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">因为选择最大的</span><span style="color: rgb(51, 51, 51);">Boot1+Boot2+RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">做为</span><span style="color: rgb(51, 51, 51);">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">的起始地址，对于部分</span><span style="color: rgb(51, 51, 51);">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">来说会造成空间浪费；</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;">B.<span style="font-size: 7pt; line-height: normal;">    </span></span><span style="color: rgb(51, 51, 51);">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">的地址可能不是</span><span style="color: rgb(51, 51, 51);">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51);">0x0</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">地址，会出现地址不对齐的现象，影响</span><span style="color: rgb(51, 51, 51);">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">操作的</span><span style="color: rgb(51, 51, 51);">performance</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">；</span></p>
<p style="line-height: 32px; text-indent: -18pt; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;">C.<span style="font-size: 7pt; line-height: normal;">    </span></span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">对于已经出货的机器，如果后续采用的</span><span style="color: rgb(51, 51, 51);">Flash</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51);">Boot1+Boot2+RPMB</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">值变大，会导致整个系统</span><span style="color: rgb(51, 51, 51);">partition layout</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">的变化，这样会影响</span><span style="color: rgb(51, 51, 51);">OTA</span><span lang="ZH-CN" style="color: rgb(51, 51, 51);" xml:lang="ZH-CN">升级。</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-size: 12pt;">    <span lang="ZH-CN" xml:lang="ZH-CN">为了解决以上的不足，在</span></span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MT6592</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">平台及后面的新平台上，使用了新的兼容方式：使用物理地址</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">(region, offset)</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">，在下载的时候，</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">DA<span lang="ZH-CN" xml:lang="ZH-CN">读取</span>Flash<span lang="ZH-CN" xml:lang="ZH-CN">上</span></span><span style="color: rgb(51, 51, 51); font-size: 12pt;">Boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">和</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的位置，分别将</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">preloader</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">下载到</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">boot1</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">0x0</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">位置；将</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">MBR</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">等其它</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">image</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">下载到</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">User Region</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">的</span><span style="color: rgb(51, 51, 51); font-size: 12pt;">0x0</span><span lang="ZH-CN" style="color: rgb(51, 51, 51); font-size: 12pt;" xml:lang="ZH-CN">地址开始的位置，如下图所示：</span></p>
<p style="line-height: 32px; word-break: break-all;"><span style="line-height: 26.666664123535156px; color: rgb(51, 51, 51); font-size: 10pt;"><img src="Flash 兼容（Combo）的实现及现状_files/Image [3].jpg" type="image/jpeg" alt=""/> </span></p>
<p> </p>
<p style="line-height: 24px; word-break: break-all;"> </p>
</div>
</div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<div><br/></div>
</span>
</div></body></html> 