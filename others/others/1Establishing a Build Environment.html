<html>
<head>
  <title>1Establishing a Build Environment</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1239"/>
<h1>1Establishing a Build Environment</h1>

<div>
<span><div style="padding: 2.2em 0px 0.2em; color: rgb(34, 34, 34); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px auto; width: 940px; clear: both; transition: all 0.25s ease-out; max-width: 940px; height: 41px; border-bottom-width: 1px; border-bottom-style: solid; border-color: rgb(204, 204, 204); position: relative;"><div style="display: inline; float: left; margin: -3px 30px 0px 0px; width: 140px; padding-right: 0px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204);"><a href="http://source.android.com/index.html" style="color: rgb(37, 138, 175); text-decoration: none;"><img src="1Establishing a Build Environment_files/Image.png" type="image/png" alt="Android Open Source Project" height="25" style="border: 0px; vertical-align: middle; max-width: 100%; height: auto;" width="123"/></a></div><ul style="margin: -2px 10px 0px 0px; padding: 0px; display: inline; float: left; width: 520px; list-style-type: none;"><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/source/index.html" style="color: rgb(51, 181, 229); text-decoration: none; font-size: 16px;">Source</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/devices/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Devices</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/security/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Security</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/compatibility/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Compatibility</a></li></ul><div style="position: absolute; right: 6px; top: -9px; width: 40px; height: 35px; z-index: 99; overflow: hidden; opacity: 0; transform-origin: 100% 0% 0px; transition-property: -webkit-opacity; transition-duration: 0.25s; transition-timing-function: ease;"><div style="width: 228px; padding: 10px 20px 0px; background: url(http://source.android.com/assets/images/more_mid.png) repeat-y;"><div style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); font-weight: bold;">Android Sites</div><ul style="margin: 10px 10px 20px 0px; padding: 0px;"><li><a style="color: rgb(34, 34, 34) !important;">Android Open Source Project</a><a href="http://www.android.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android.com</a><a href="http://developer.android.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android Developers</a></li></ul><br/></div></div></div></div><div style="margin: 0px auto; width: 940px; clear: both; color: rgb(34, 34, 34); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="display: inline; float: left; margin-left: 0px; margin-right: 10px; width: 220px; min-height: 5px; margin-bottom: 1px; overflow: hidden;"><div style="outline: none; width: 220px; margin: 20px 0px 0px; overflow: hidden; padding: 0px; height: 884px;"><div style="overflow: hidden; position: relative; width: 220px; height: 884px;"><div style="position: absolute; overflow: hidden; width: 220px; padding: 0px; top: 0px;"><ul style="margin: 0px; padding: 0px 0px 30px; width: 216px;"><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/index.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Overview</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px; background: rgba(0, 0, 0, 0.0470588);"><a href="http://source.android.com/source/requirements.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Downloading and Building</a></div></li><li style="list-style: none; display: inline"><ul style="margin: 0px; padding: 0px; display: block; overflow: hidden;"><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/initializing.html" style="color: rgb(0, 153, 204); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Establishing a Build Environment</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/downloading.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Downloading the Source</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/building.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Building the System</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/jack.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Compiling with Jack</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/devices.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Selecting Devices</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/running.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Running Builds</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/building-kernels.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Building Kernels</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px 0px 5px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/known-issues.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Known Issues</a></li></ul></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/developing.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Developing</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/contributing.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Contributing</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/community.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Community</a></div></li></ul></div></div></div></div><div style="display: inline; float: left; margin-left: 10px; margin-right: 0px; width: 700px;"><h1 style="color: rgb(51, 51, 51); font-size: 34px; margin: 36px 0px 27px; padding: 0px 0px 10px; font-weight: 300;">Establishing a Build Environment</h1><div><div style="float: right; clear: right; margin: -27px 0px 0px 20px; padding: 0px 0px 20px;"><div style="font-size: 13px; width: 238px; border: 1px solid rgb(204, 204, 204); float: right;"><h2 style="color: rgb(51, 51, 51); font-size: inherit; margin: 10px 15px; padding: 0px; font-weight: 300; text-transform: uppercase; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: gainsboro;">IN THIS DOCUMENT</h2><ol style="margin: 0px 15px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#choosing-a-branch" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Choosing a Branch</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#setting-up-a-linux-build-environment" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Setting up a Linux build environment</a><ol style="margin: 3px 0px 3px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#installing-the-jdk" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Installing the JDK</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#installing-required-packages-ubuntu-1404" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Installing required packages (Ubuntu 14.04)</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#installing-required-packages-ubuntu-1204" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Installing required packages (Ubuntu 12.04)</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#installing-required-packages-ubuntu-1004-1110" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Installing required packages (Ubuntu 10.04 -- 11.10)</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#configuring-usb-access" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Configuring USB Access</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#using-a-separate-output-directory" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Using a separate output directory</a></li></ol></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#setting-up-a-mac-os-x-build-environment" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Setting up a Mac OS build environment</a><ol style="margin: 3px 0px 3px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#creating-a-case-sensitive-disk-image" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Creating a case-sensitive disk image</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#installing-the-mac-jdk" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Installing the JDK</a></li></ol></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#optimizing-a-build-environment" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Optimizing a build environment (optional)</a><ol style="margin: 3px 0px 3px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#setting-up-ccache" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Setting up ccache</a></li></ol></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/initializing.html#next-download-the-source" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Next: Download the source</a></li></ol></div></div><p style="margin: 0px 0px 15px;">This section describes how to set up your local work environment to build the Android source files. You will need to use Linux or Mac OS. Building under Windows is not currently supported.</p><p style="margin: 0px 0px 15px;">For an overview of the entire code-review and code-update process, see <a href="http://source.android.com/source/life-of-a-patch.html" style="color: rgb(37, 138, 175); text-decoration: none;">Life of a Patch</a>.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Choosing a Branch</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">Some of the requirements for your build environment are determined by which version of the source code you plan to compile. See <a href="http://source.android.com/source/build-numbers.html" style="color: rgb(37, 138, 175); text-decoration: none;">Build Numbers</a> for a full listing of branches you may choose from. You may also choose to download and build the latest source code (called<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code>), in which case you will simply omit the branch specification when you initialize the repository.</p><p style="margin: 0px 0px 15px;">Once you have selected a branch, follow the appropriate instructions below to set up your build environment.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Setting up a Linux build environment</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">These instructions apply to all branches, including <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code>.</p><p style="margin: 0px 0px 15px;">The Android build is routinely tested in house on recent versions of Ubuntu LTS (14.04), but most distributions should have the required build tools available. Reports of successes or failures on other distributions are welcome.</p><p style="margin: 0px 0px 15px;">For Gingerbread (2.3.x) and newer versions, including the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code> branch, a 64-bit environment is required. Older versions can be compiled on 32-bit systems.</p><p style="margin: 0px 0px 15px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(37, 138, 175);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Note:</strong> See the <a href="http://source.android.com/source/requirements.html" style="color: rgb(37, 138, 175); text-decoration: none;">Requirements</a> for the complete list of hardware and software requirements. Then follow the detailed instructions for Ubuntu and Mac OS below.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Installing the JDK</h3><p style="margin: 0px 0px 15px;">The <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code> branch of Android in the <a href="https://android.googlesource.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android Open Source Project (AOSP)</a> requires Java 8. On Ubuntu, use<a href="http://openjdk.java.net/install/" style="color: rgb(37, 138, 175); text-decoration: none;">OpenJDK</a>.</p><p style="margin: 0px 0px 15px;">Java 8: For the latest version of Android</p><h4 style="font-size: 18px; margin: 12px 0px; font-weight: 500;">For Ubuntu &gt;= 15.04</h4><p style="margin: 0px 0px 15px;">Run the following:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo apt-get update
$ sudo apt-get install openjdk-8-jdk
</code></pre><h4 style="font-size: 18px; margin: 12px 0px; font-weight: 500;">For Ubuntu LTS 14.04</h4><p style="margin: 0px 0px 15px;">There are no available supported OpenJDK 8 packages for Ubuntu 14.04. The <strong style="font-weight: bold; color: rgb(34, 34, 34);">Ubuntu 15.04 OpenJDK 8</strong>packages have been used successfully with Ubuntu 14.04. <em style="font-style: italic;">Newer package versions (e.g. those for 15.10, 16.04) were found not to work on 14.04 using the instructions below.</em></p><ol style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Download the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.deb</code> packages for your architecture from <a href="http://packages.ubuntu.com/vivid/openjdk-8-jdk" style="color: rgb(37, 138, 175); text-decoration: none;">http://packages.ubuntu.com/vivid/openjdk-8-jdk</a>:</p><ul style="margin: 5px 0px 5px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><a href="http://packages.ubuntu.com/vivid/openjdk-8-jre-headless" style="color: rgb(37, 138, 175); text-decoration: none;">openjdk-8-jre-headless</a></li><li style="margin: 0px 0px 5px;"><a href="http://packages.ubuntu.com/vivid/openjdk-8-jre" style="color: rgb(37, 138, 175); text-decoration: none;">openjdk-8-jre</a></li><li style="margin: 0px 0px 5px;"><a href="http://packages.ubuntu.com/vivid/openjdk-8-jdk" style="color: rgb(37, 138, 175); text-decoration: none;">openjdk-8-jdk</a></li></ul></li><li><p style="margin: 5px 0px;">With <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">x86_64</code> representing a 64-bit (amd64) Linux kernel architecture and <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">i386/i486/i586/i686</code> representing a 32-bit (i386) system.</p><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ uname -m</code><p style="margin: 5px 0px;">Remember, you may obtain the architecture for your machine with:</p></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Optionally, confirm the checksums of the downloaded files using the information found on<a href="http://packages.ubuntu.com/vivid/openjdk-8-jdk" style="color: rgb(37, 138, 175); text-decoration: none;">http://packages.ubuntu.com/vivid/openjdk-8-jdk</a>.</p><p style="margin: 5px 0px;">For example with the sha256sum tool:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sha256sum {package file}</code></pre></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Install the packages:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo apt-get update</code></pre><p style="margin: 5px 0px;">Run dpkg for each of the .deb files you downloaded. It may produce errors due to missing dependencies:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo dpkg -i {downloaded.deb file}</code></pre><p style="margin: 5px 0px;">To fix missing dependencies:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo apt-get -f install</code></pre></li></ol><h4 style="font-size: 18px; margin: 12px 0px; font-weight: 500;">Update the default Java version - optional</h4><p style="margin: 0px 0px 15px;">Optionally, for the Ubuntu versions above update the default Java version by running:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo update-alternatives --config java
$ sudo update-alternatives --config javac
</code></pre><p style="margin: 0px 0px 15px;">If, during a build, you encounter version errors for Java, set its path as described in the <a href="http://source.android.com/source/building.html#wrong-java-version" style="color: rgb(37, 138, 175); text-decoration: none;">Wrong Java Version</a>section.</p><p style="margin: 0px 0px 15px;">To develop older versions of Android, download and install the corresponding version of the <a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" style="color: rgb(37, 138, 175); text-decoration: none;">Java JDK</a>:<br/>
Java 7: for Lollipop through Marshmallow<br/>
Java 6: for Gingerbread through KitKat<br/>
Java 5: for Cupcake through Froyo</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Installing required packages (Ubuntu 14.04)</h3><p style="margin: 0px 0px 15px;">You will need a 64-bit version of Ubuntu. Ubuntu 14.04 is recommended.</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo apt-get install git-core gnupg flex bison gperf build-essential \
  zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 \
  lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache \
  libgl1-mesa-dev libxml2-utils xsltproc unzip
</code></pre><p style="margin: 0px 0px 15px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(37, 138, 175);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Note:</strong> To use SELinux tools for policy analysis, also install the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">python-networkx</code> package.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Installing required packages (Ubuntu 12.04)</h3><p style="margin: 0px 0px 15px;">You may use Ubuntu 12.04 to build older versions of Android. Version 12.04 is not supported on master or recent releases.</p><div style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><div>$ sudo apt-get install git` gnupg flex bison gperf build-essential \</div><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">  zip curl libc6-dev libncurses5-dev:i386 x11proto-core-dev \<br/>
  libx11-dev:i386 libreadline6-dev:i386 libgl1-mesa-glx:i386 \<br/>
  libgl1-mesa-dev g++-multilib mingw32 tofrodos \<br/>
  python-markdown libxml2-utils xsltproc zlib1g-dev:i386<br/>
$ sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so<br/></code></div><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Installing required packages (Ubuntu 10.04 -- 11.10)</h3><p style="margin: 0px 0px 15px;">Building on Ubuntu 10.04-11.10 is no longer supported, but may be useful for building older releases of AOSP.</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo apt-get install git gnupg flex bison gperf build-essential \
  zip curl zlib1g-dev libc6-dev lib32ncurses5-dev ia32-libs \
  x11proto-core-dev libx11-dev lib32readline5-dev lib32z-dev \
  libgl1-mesa-dev g++-multilib mingw32 tofrodos python-markdown \
  libxml2-utils xsltproc
</code></pre><p style="margin: 0px 0px 15px;">On Ubuntu 10.10:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo ln -s /usr/lib32/mesa/libGL.so.1 /usr/lib32/mesa/libGL.so
</code></pre><p style="margin: 0px 0px 15px;">On Ubuntu 11.10:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo apt-get install libx11-dev:i386
</code></pre><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Configuring USB Access</h3><p style="margin: 0px 0px 15px;">Under GNU/Linux systems (and specifically under Ubuntu systems), regular users can't directly access USB devices by default. The system needs to be configured to allow such access.</p><p style="margin: 0px 0px 15px;">The recommended approach is to create a file at <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/etc/udev/rules.d/51-android.rules</code> (as the root user).</p><p style="margin: 0px 0px 15px;">To do this, run the following command to download the <a href="http://source.android.com/source/51-android.rules" style="color: rgb(37, 138, 175); text-decoration: none;">51-android.rules</a> file attached to this site, modify it to include your username, and place it in the correct location:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ wget -S -O - http://source.android.com/source/51-android.rules | sed &quot;s/&lt;username&gt;/$USER/&quot; | sudo tee &gt;/dev/null /etc/udev/rules.d/51-android.rules; sudo udevadm control --reload-rules</code></pre><p style="margin: 0px 0px 15px;">Those new rules take effect the next time a device is plugged in. It might therefore be necessary to unplug the device and plug it back into the computer.</p><p style="margin: 0px 0px 15px;">This is known to work on both Ubuntu Hardy Heron (8.04.x LTS) and Lucid Lynx (10.04.x LTS). Other versions of Ubuntu or other variants of GNU/Linux might require different configurations.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Using a separate output directory</h3><p style="margin: 0px 0px 15px;">By default, the output of each build is stored in the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">out/</code> subdirectory of the matching source tree.</p><p style="margin: 0px 0px 15px;">On some machines with multiple storage devices, builds are faster when storing the source files and the output on separate volumes. For additional performance, the output can be stored on a filesystem optimized for speed instead of crash robustness, since all files can be re-generated in case of filesystem corruption.</p><p style="margin: 0px 0px 15px;">To set this up, export the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">OUT_DIR_COMMON_BASE</code> variable to point to the location where your output directories will be stored.</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">export OUT_DIR_COMMON_BASE=&lt;path-to-your-out-directory&gt;
</code></pre><p style="margin: 0px 0px 15px;">The output directory for each separate source tree will be named after the directory holding the source tree.</p><p style="margin: 0px 0px 15px;">For instance, if you have source trees as <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/source/master1</code> and <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/source/master2</code> and <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">OUT_DIR_COMMON_BASE</code> is set to<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/output</code>, the output directories will be <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/output/master1</code> and <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/output/master2</code>.</p><p style="margin: 0px 0px 15px;">It's important in that case to not have multiple source trees stored in directories that have the same name, as those would end up sharing an output directory, with unpredictable results.</p><p style="margin: 0px 0px 15px;">This is only supported on Jelly Bean (4.1) and newer, including the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code> branch.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Setting up a Mac OS build environment</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">In a default installation, Mac OS runs on a case-preserving but case-insensitive filesystem. This type of filesystem is not supported by git and will cause some git commands (such as <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">git status</code>) to behave abnormally. Because of this, we recommend that you always work with the AOSP source files on a case-sensitive filesystem. This can be done fairly easily using a disk image, discussed below.</p><p style="margin: 0px 0px 15px;">Once the proper filesystem is available, building the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">master</code> branch in a modern Mac OS environment is very straightforward. Earlier branches, including ICS, require some additional tools and SDKs.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Creating a case-sensitive disk image</h3><p style="margin: 0px 0px 15px;">You can create a case-sensitive filesystem within your existing Mac OS environment using a disk image. To create the image, launch Disk Utility and select &quot;New Image&quot;. A size of 25GB is the minimum to complete the build; larger numbers are more future-proof. Using sparse images saves space while allowing to grow later as the need arises. Be sure to select &quot;case sensitive, journaled&quot; as the volume format.</p><p style="margin: 0px 0px 15px;">You can also create it from a shell with the following command:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"># hdiutil create -type SPARSE -fs 'Case-sensitive Journaled HFS+' -size 40g ~/android.dmg
</code></pre><p style="margin: 0px 0px 15px;">This will create a <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.dmg</code> (or possibly a <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.dmg.sparseimage</code>) file which, once mounted, acts as a drive with the required formatting for Android development.</p><p style="margin: 0px 0px 15px;">If you need a larger volume later, you can also resize the sparse image with the following command:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"># hdiutil resize -size &lt;new-size-you-want&gt;g ~/android.dmg.sparseimage
</code></pre>
For a disk image named <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">android.dmg</code> stored in your home directory, you can add helper functions to your<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">~/.bash_profile</code>:
<ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;">To mount the image when you execute <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">mountAndroid</code>:
<p style="margin: 5px 0px;"></p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"># mount the android file image
function mountAndroid { hdiutil attach ~/android.dmg -mountpoint /Volumes/android; }
</code></pre><p style="margin: 5px 0px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(37, 138, 175);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Note:</strong> If your system created a <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.dmg.sparseimage</code> file, replace <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">~/android.dmg</code> with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">~/android.dmg.sparseimage</code>.</p></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">To unmount it when you execute <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">umountAndroid</code>:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"># unmount the android file image
function umountAndroid() { hdiutil detach /Volumes/android; }
</code></pre></li></ul><p style="margin: 0px 0px 15px;">Once you've mounted the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">android</code> volume, you'll do all your work there. You can eject it (unmount it) just like you would with an external drive.</p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Installing the JDK</h3><p style="margin: 0px 0px 15px;">See <a href="http://source.android.com/source/requirements.html" style="color: rgb(37, 138, 175); text-decoration: none;">Requirements</a> for the version of Java to use when developing various versions of Android.</p><h4 style="font-size: 18px; margin: 12px 0px; font-weight: 500;">Installing required packages</h4><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Install Xcode from <a href="http://developer.apple.com/" style="color: rgb(37, 138, 175); text-decoration: none;">the Apple developer site</a>. If you are not already registered as an Apple developer, you will have to create an Apple ID in order to download.</p></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Install MacPorts from <a href="http://www.macports.org/install.php" style="color: rgb(37, 138, 175); text-decoration: none;">macports.org</a>.</p><p style="margin: 5px 0px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(37, 138, 175);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Note:</strong> Make sure that <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/opt/local/bin</code> appears in your path <strong style="font-weight: bold; color: rgb(34, 34, 34);">before</strong> <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/usr/bin</code>. If not, please add the following to your <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">~/.bash_profile</code> file:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">export PATH=/opt/local/bin:$PATH</code></pre><p style="margin: 5px 0px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(37, 138, 175);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Note:</strong> If you do not have a <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.bash_profile</code> file in your home directory, create one.</p></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Get make, git, and GPG packages from MacPorts:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ POSIXLY_CORRECT=1 sudo port install gmake libsdl git gnupg
</code></pre><p style="margin: 5px 0px;">If using Mac OS X v10.4, also install bison:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ POSIXLY_CORRECT=1 sudo port install bison
</code></pre></li></ul><h4 style="font-size: 18px; margin: 12px 0px; font-weight: 500;">Reverting from make 3.82</h4><p style="margin: 0px 0px 15px;">In Android 4.0.x (Ice Cream Sandwich) and earlier, a bug exists in gmake 3.82 that prevents android from building. You can install version 3.81 using MacPorts with these steps:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Edit <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">/opt/local/etc/macports/sources.conf</code> and add a line that says</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">file:///Users/Shared/dports
</code></pre><p style="margin: 5px 0px;">above the rsync line. Then create this directory:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ mkdir /Users/Shared/dports
</code></pre></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">In the new <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">dports</code> directory, run</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ svn co --revision 50980 http://svn.macports.org/repository/macports/trunk/dports/devel/gmake/ devel/gmake/
</code></pre></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Create a port index for your new local repository:</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ portindex /Users/Shared/dports
</code></pre></li><li style="margin: 0px 0px 5px;"><p style="margin: 5px 0px;">Finally, install the old version of gmake with</p><pre style="font-size: 13px; margin: 5px 0px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$ sudo port install gmake @3.81
</code></pre></li></ul><h4 style="font-size: 18px; margin: 12px 0px; font-weight: 500;">Setting a file descriptor limit</h4><p style="margin: 0px 0px 15px;">On Mac OS, the default limit on the number of simultaneous file descriptors open is too low and a highly parallel build process may exceed this limit.<br/></p><p style="margin: 0px 0px 15px;">To increase the cap, add the following lines to your <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">~/.bash_profile</code>:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"># set the number of open files to be 1024
ulimit -S -n 1024
</code></pre><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Optimizing a build environment (optional)</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;"><a name="ccache"></a></p><h3 style="color: rgb(51, 51, 51); font-size: 21px; font-weight: 400; margin: 21px 0px 14px;">Setting up ccache</h3><p style="margin: 0px 0px 15px;">You can optionally tell the build to use the ccache compilation tool. Ccache acts as a compiler cache that can be used to speed up rebuilds. This works very well if you use <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make clean</code> often, or if you frequently switch between different build products.</p><p style="margin: 0px 0px 15px;">Put the following in your <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.bashrc</code> (or equivalent):</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">export USE_CCACHE=1
</code></pre><p style="margin: 0px 0px 15px;">By default the cache will be stored in <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">~/.ccache</code>. If your home directory is on NFS or some other non-local filesystem, you will want to specify the directory in your <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">.bashrc</code> file as well:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">export CCACHE_DIR=&lt;path-to-your-cache-directory&gt;
</code></pre><p style="margin: 0px 0px 15px;">The suggested cache size is 50-100GB. You will need to run the following command once you have downloaded the source code:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">prebuilts/misc/linux-x86/ccache/ccache -M 50G
</code></pre><p style="margin: 0px 0px 15px;">On Mac OS, you should replace <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">linux-x86</code> with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">darwin-x86</code>:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">prebuilts/misc/darwin-x86/ccache/ccache -M 50G
</code></pre><p style="margin: 0px 0px 15px;">When building Ice Cream Sandwich (4.0.x) or older, ccache is in a different location:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">prebuilt/linux-x86/ccache/ccache -M 50G
</code></pre><p style="margin: 0px 0px 15px;">This setting is stored in the CCACHE_DIR and is persistent.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Next: Download the source</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">Your build environment is good to go! Proceed to <a href="http://source.android.com/source/downloading.html" style="color: rgb(37, 138, 175); text-decoration: none;">downloading the source</a>.</p></div><div style="margin: 10px auto 0px; width: auto; clear: both; font-size: 11px; color: rgb(153, 153, 153); padding: 15px 0px;"><div style="margin: 0px 0px 0px 10px; font-size: 14px; float: right !important;"><a href="http://source.android.com/source/initializing.html#" style="border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; border-radius: 2px; cursor: pointer; display: inline-block; border: 1px solid rgb(57, 144, 171); color: rgb(255, 255, 255); margin-right: 16px; font-weight: 400; min-width: 54px; outline: 0px; padding: 8px 15px; text-align: center; text-decoration: none; background-image: -webkit-linear-gradient(top, rgb(47, 173, 219), rgb(0, 153, 204)); background-color: rgb(0, 153, 204);">Site Feedback</a></div><div>Except as noted, this content is licensed under <a href="http://creativecommons.org/licenses/by/2.5/" style="color: rgb(37, 138, 175); text-decoration: none;">Creative Commons Attribution 2.5</a>. For details and restrictions, see the <a href="http://source.android.com/license.html" style="color: rgb(37, 138, 175); text-decoration: none;">Content License</a>.</div><div style="margin: 0px 0px 15px;"><div><a href="http://source.android.com/source/index.html" style="color: rgb(37, 138, 175); text-decoration: none;">About Android</a>  |  <a href="http://source.android.com/source/community.html" style="color: rgb(37, 138, 175); text-decoration: none;">Community</a>  |  <a href="http://source.android.com/legal.html" style="color: rgb(37, 138, 175); text-decoration: none;">Legal</a>  | </div></div></div></div></div></span>
</div></body></html> 