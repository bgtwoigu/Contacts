<html>
<head>
  <title>82 如何在源码集成apk时指定签名</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6689"/>
<h1>82 如何在源码集成apk时指定签名</h1>

<div>
<span><div><span style="font-size: 16px;">有些apk是需要绑定签名的，当开发者绑定了他自己的开发环境的 debug.keystore 的签名，而与系统签名不一样，这就导致不能用源码集成的方式集成apk。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">方法：</span></div><div><span style="font-size: 16px;">将 debug.keystore 转换成 源码能用的 .pk8 和 .pem 文件，然后在Android.mk中指定签名文件的路径</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">1 如何制作 .pk8 和 .pem 文件</span></div><div><font size="4"><span>将debug.keysotre 放到ubuntu目录下</span></font></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 15px;"><span>执行</span></span></li></ul><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);"><div><span style="font-family: Monaco, Menlo, Consolas, &apos;Courier New&apos;, monospace;"><span style="color: rgb(51, 51, 51);">keytool -importkeystore -srckeystore debug.keystore -destkeystore tmp.p12 -srcstoretype JKS -deststoretype PKCS12</span></span></div></div><div><font size="4"><span>生成 </span></font>tmp.p12</div><div><br/></div><ul><li>然后执行</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>openssl pkcs12 -in tmp.p12 -nodes -out tmp.rsa.pem</div></div><div>生成 tmp.rsa.pem</div><div><br/></div><ul><li>打开 tmp.rsa.pem 文件，</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Bag Attributes</div><div>    friendlyName: androiddebugkey</div><div>    localKeyID: 54 69 6D 65 20 31 33 38 38 39 37 38 34 32 36 38 36 39</div><div>Key Attributes: &lt;No Attributes&gt;</div><div>-----BEGIN PRIVATE KEY-----</div><div>...</div><div>-----END PRIVATE KEY-----</div><div>Bag Attributes</div><div>    friendlyName: androiddebugkey</div><div>    localKeyID: 54 69 6D 65 20 31 33 38 38 39 37 38 34 32 36 38 36 39</div><div>subject=/C=US/O=Android/CN=Android Debug</div><div>issuer=/C=US/O=Android/CN=Android Debug</div><div>-----BEGIN CERTIFICATE-----</div><div>...</div><div>-----END CERTIFICATE-----</div></div><div><br/></div><ul><li>新建文件叫  <span style="color: rgb(36, 36, 36); font-family: Tahoma, sans-serif; font-size: 14.399999618530273px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); display: inline !important; float: none;">cert.x509.pem</span></li></ul><div><font size="4"><span>将 </span></font>tmp.rsa.pem 中的</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>-----BEGIN CERTIFICATE-----</div><div>...</div><div>-----END CERTIFICATE-----</div></div><div>复制到 c<span style="color: rgb(36, 36, 36); font-family: Tahoma, sans-serif; font-size: 14.399999618530273px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); display: inline !important; float: none;">ert.x509.pem 中保存</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li>新建文件叫  <span style="color: rgb(36, 36, 36); font-family: Tahoma, sans-serif; font-size: 14.399999618530273px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); display: inline !important; float: none;">private.rsa.pem</span></li></ul><div><font color="#242424" face="Tahoma, sans-serif"><span style="font-size: 14px;">将</span></font><font size="4"> </font>tmp.rsa.pem 中的</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>-----BEGIN PRIVATE KEY-----</div><div>...</div><div>-----END PRIVATE KEY-----</div></div><div>复制到 <span style="color: rgb(36, 36, 36); font-family: Tahoma, sans-serif; font-size: 14.399999618530273px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247); display: inline !important; float: none;">private.rsa.pem 中保存</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><font size="4"><span>然后执行</span></font></li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>openssl pkcs8 -topk8 -outform DER -in private.rsa.pem -inform PEM -out private.pk8 -nocrypt</div></div><div><span style="font-size: 16px;"><br/></span></div><div><font size="4"><span>生成了我们需要的文件 </span></font>private.pk8   private.rsa.pem</div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">2 如何指定签名文件</span></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Android.mk加上一句代码：   <span style="color: rgb(255, 0, 0);"><b>LOCAL_CERTIFICATE := vendor/xxxxx</b></span>      #写上签名文件的地址</div></div><div><img src="82 如何在源码集成apk时指定签名_files/Image.png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div>假定： 将 private.pk8   private.rsa.pem 这两个文件放到 vendor/certs/private/ 目录</div><div>上面Android.mk的LOCAL_CERTIFICATE := vendor/certs/private</div><div><br/></div><div>文件可以改名，但名字需要跟LOCAL_CERTIFICATE 最后一个'/'后面的单词一致</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 