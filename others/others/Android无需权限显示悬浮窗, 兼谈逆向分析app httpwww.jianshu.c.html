<html>
<head>
  <title>Android无需权限显示悬浮窗, 兼谈逆向分析app http://www.jianshu.com/p/167fd5f47d5c</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1812"/>
<h1>Android无需权限显示悬浮窗, 兼谈逆向分析app http://www.jianshu.com/p/167fd5f47d5c</h1>

<div>
<span><div style="overflow: visible; margin-bottom: 20px; position: fixed; width: 170px; z-index: 1049; backface-visibility: hidden; left: 0px; top: 0px; height: 1018px; color: rgb(85, 85, 85); font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(42, 42, 42);"><div style="position: relative;"><a href="http://www.jianshu.com/" style="color: white; text-decoration: none; display: block; padding: 10px 15px; font-size: 18px; text-align: left; text-shadow: rgb(222, 83, 58) 0px 1px 0px; background-color: rgb(231, 129, 112);"><span style="display: inline-block; padding: 0px; margin-left: 8px; font-size: 14px; font-weight: normal;">首页</span></a><a href="http://www.jianshu.com/collections" style="color: rgb(153, 153, 153); text-decoration: none; display: block; padding: 10px 15px; font-size: 16px; text-align: left; text-shadow: black 0px 1px 0px;"><span style="display: inline-block; padding: 0px; margin-left: 8px; font-size: 14px; font-weight: normal;">专题</span></a><a href="http://www.jianshu.com/apps" style="color: rgb(153, 153, 153); text-decoration: none; display: block; padding: 10px 15px; font-size: 16px; text-align: left; text-shadow: black 0px 1px 0px;"><span style="display: inline-block; padding: 0px; margin-left: 8px; font-size: 14px; font-weight: normal;">下载手机应用</span></a></div><div style="position: absolute; bottom: 0px; width: 170px; padding-bottom: 5px;"><a href="http://www.jianshu.com/p/167fd5f47d5c#view-mode-modal" style="color: rgb(153, 153, 153); text-decoration: none; display: block; padding: 10px 15px; font-size: 16px; text-align: left; text-shadow: black 0px 1px 0px; position: relative;"><span style="padding: 0px; display: inline-block; margin-left: 8px; font-size: 14px; font-weight: normal;">显示模式</span></a><a href="http://www.jianshu.com/sign_in" style="color: rgb(153, 153, 153); text-decoration: none; display: block; padding: 10px 15px; font-size: 16px; text-align: left; text-shadow: black 0px 1px 0px; position: relative;"><span style="padding: 0px; display: inline-block; margin-left: 8px; font-size: 14px; font-weight: normal;">登录</span></a></div></div><div style="position: fixed; right: 36.8125px; bottom: 20.3594px; width: 40px; border: 1px solid rgb(238, 238, 238); font-size: 24px; z-index: 1040; backface-visibility: hidden; color: rgb(85, 85, 85); font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a style="color: rgb(85, 85, 85); text-decoration: none; display: inline-block; width: 40px; height: 40px; text-align: center;"></a><a href="http://www.jianshu.com/writer#/" style="color: white; text-decoration: none; display: inline-block; width: 40px; height: 40px; text-align: center; font-size: 18px; background-color: rgb(73, 190, 56);"></a></div><div style="position: relative; color: rgb(85, 85, 85); font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; position: fixed; right: 0px; width: 1841px; padding-top: 10px; padding-bottom: 7px; box-shadow: whitesmoke 0px 1px 3px; z-index: 1000; transition: transform 0.5s cubic-bezier(0.56, -0.29, 0.57, 1), opacity 0.1s; backface-visibility: hidden; top: -1px; background: rgba(255, 255, 255, 0.901961);"><div style="float: left; padding-left: 195px;"><a style="color: rgb(231, 129, 112); text-decoration: none; width: 32px; height: 32px; margin-right: 10px; display: inline-block; border-radius: 50%; border: 1px solid rgb(231, 129, 112); text-align: center;"></a> <a style="color: rgb(231, 129, 112); text-decoration: none; left: 195px; width: 32px; height: 32px; margin-right: 10px; display: inline-block; border-radius: 50%; border: 1px solid rgb(231, 129, 112); text-align: center;"></a></div><a href="http://www.jianshu.com/sign_up" style="color: rgb(85, 85, 85); text-decoration: none; position: relative; top: 7px; float: right; padding: 0px 2px; margin-right: 8px;"> 注册</a><a href="http://www.jianshu.com/sign_in" style="color: rgb(85, 85, 85); text-decoration: none; position: relative; top: 7px; float: right; padding: 0px 2px; margin-right: 8px;"> 登录</a></div><div style="width: 700px; margin-right: auto; margin-left: auto;"><div style="bottom: 0px; padding: 80px 40px 10px;"><div><div style="padding-bottom: 15px; margin-bottom: 30px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; font-size: 12px; color: rgb(153, 153, 153);"><div style="display: inline-block; padding: 2px 10px; margin-bottom: 0px; font-size: 12px; text-align: center; vertical-align: middle; cursor: pointer; color: white; text-shadow: none; border: 1px solid rgb(73, 190, 56); border-radius: 50px; box-shadow: none; font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-weight: normal; margin-top: 10px; float: right; background: rgb(73, 190, 56);"><a href="http://www.jianshu.com/sign_in" style="color: white; text-decoration: none;"> <span style="padding-left: 7px; margin-left: 3px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(217, 217, 217);">添加关注</span></a></div><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; float: left; width: 40px; height: 40px; margin-right: 10px;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image.jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 40px; vertical-align: middle; border: 2px solid white; width: 40px; border-radius: 50%; box-sizing: border-box;"/></a><span style="display: inline-block; padding: 2px 4px; font-size: 11px; font-weight: normal; color: rgb(231, 129, 112); vertical-align: baseline; white-space: nowrap; text-shadow: none; border-radius: 3px; border: 1px solid rgb(231, 129, 112); background: none;">作者</span> <a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none; margin: 0px 5px;">Shawon </a>2015.10.16 20:48*
<div style="margin-top: 3px;">写了32839字，被293人关注，获得了174个喜欢</div></div><h1 style="margin: 10px 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 32px; word-break: break-all;">Android无需权限显示悬浮窗, 兼谈逆向分析app</h1><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 20px 0px;"><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153);">字数4768</span> <span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153);">阅读11213</span> <span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153);">评论47</span> <span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153);">喜欢122</span></div><div style="color: rgb(47, 47, 47); font-size: 16px; font-weight: normal;"><h1 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 26px;">前言</h1><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">最近UC浏览器中文版出了一个快速搜索的功能, 在使用其他app的时候, 如果复制了一些内容, 屏幕顶部会弹一个窗口, 提示一些操作, 点击后跳转到UC, 显示这个悬浮窗不需要申请<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">android.permission.SYSTEM_ALERT_WINDOW</code>权限.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">如下图, 截图是在使用Chrome时截的, 但是屏幕顶部却有UC的view浮在屏幕上. 我使用的是小米, 我并没有给UC授悬浮窗权限, 所以我看到这个悬浮窗时是很震惊的.<br/></p><div style="margin: 0px auto 20px; text-align: center;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [1].jpg" type="image/jpeg" style="max-width: 100%; height: auto; vertical-align: middle; border: 0px; cursor: -webkit-zoom-in; transition: all 0.25s ease-in-out;"/><br/><div style="min-width: 20%; min-height: 22px; display: inline-block; padding: 10px; margin: 0px auto; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(217, 217, 217); font-size: 13px; color: rgb(153, 153, 153); font-style: italic;">截图</div></div><h1 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 26px;">悬浮窗原理</h1><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">做过悬浮窗功能的人都知道, 要想显示悬浮窗, 要有一个服务运行在后台, 通过<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">getSystemService(Context.WINDOW_SERVICE)</code>拿到<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager</code>, 然后向其中<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">addView</code>, <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">addView</code>第二个参数是一个<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams</code>, <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams</code>中有一个成员<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">type</code>, 有各种值, 一般设置成<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_PHONE</code>就可以悬浮在很多view的上方了, 但是调用这个方法需要申请<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">android.permission.SYSTEM_ALERT_WINDOW</code>权限, 在很多机型上, 这个权限的名字叫<em style="font-style: italic;">悬浮窗</em>, 比如小米手机上默认是禁用这个权限的, 有些恶意app会用这个权限弹广告, 而且很难追查是哪个应用弹的. 如果这个权限被禁用, 那么结果就是悬浮窗无法展示, 比如<em style="font-style: italic;">有道词典</em>的<em style="font-style: italic;">复制查词</em>功能, 在小米手机上经常没用, 其实是用户没有授权, 而且应用也没有引导用户给它打开授权.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">现在UC能突破这个限制, 我很好奇它是怎么做到的.</p><h1 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 26px;">研究实现</h1><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">Android开发有点蛋疼的地方就是太容易被反编译, 但有时这也成为我们研究别人app的一种手段.</p><h2 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24px;">反编译</h2><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">使用<em style="font-style: italic;">apktool</em>可以很轻松的反编译UC.</p><h2 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24px;">找代码</h2><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">逆向别人的app, 比较关键的地方是怎么找代码, 因为代码基本上都是混淆的, 直接看肯定是看不懂的, 只能去找, 突破口一般在字符资源上, 比如我们看到上图中的<strong style="font-weight: bold;">快速搜索</strong>是UC的字符, 那么我们到<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">res/values/strings.xml</code>去找<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">快速搜索</code>, 就可以找到下面的内容</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">&lt;<span style="color: rgb(38, 139, 210);">string</span> <span style="color: rgb(181, 137, 0);">name</span>=<span style="color: rgb(42, 161, 152);">&quot;dark_search_banner_search&quot;</span>&gt;快速搜索&lt;/<span style="color: rgb(38, 139, 210);">string</span>&gt;</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这里我们拿到了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">快速搜索</code>对应的名字<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">dark_search_banner_search</code>, Android在编译时会给每个资源分配一个id, 我们grep一下这个字符资源的名字就能知道id是多少, 一般在<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">R.java</code>,<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">res/values/public.xml</code>中有定义, 我直接到public.xml中找到了它的id</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">&lt;<span style="color: rgb(38, 139, 210);">public</span> <span style="color: rgb(181, 137, 0);">type</span>=<span style="color: rgb(42, 161, 152);">&quot;string&quot;</span> <span style="color: rgb(181, 137, 0);">name</span>=<span style="color: rgb(42, 161, 152);">&quot;dark_search_banner_search&quot;</span> <span style="color: rgb(181, 137, 0);">id</span>=<span style="color: rgb(42, 161, 152);">&quot;0x7f070049&quot;</span> /&gt;</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">有了字符资源的id <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x7f070049</code>, 我们再在代码里面grep一下这个id, 就能知道哪几个文件使用了这个字符资源.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">之所以这么确定是在代码里, 是因为UC在我们复制的内容不同时, 悬浮窗标题会不一样, 一定是在代码里控制的, 结果如下</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">./com/<span style="color: rgb(133, 153, 0);">uc</span>/browser/b/f.smali</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">结果可能和大家不一样, 但是一定会找到一个被混淆的smali文件</p><h2 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24px;">看代码</h2><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这一部应该是最恶心的. smali代码和java代码的关系, 就像汇编代码和C++代码, 但是smali比汇编代码要容易理解的多, 不然也不会有那么多公司故意将代码写在C++层了.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">虽然代码都被混淆了, 而且以我们不熟悉的方式出现, 但我们可以根据一些蛛丝马迹来判断代码的执行, 比如Framework的类和API是不能被混淆的, 这也是我们能看懂smali的原因之一, 我们可以结合这些面包屑来还原整个app代码, 当然这需要我们对smali很熟悉, 如果不熟悉smali, 至少要对Android的API熟悉. 因为有时实在看不懂, 我们要靠猜来还原一段代码的逻辑.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">首先在代码里面找到<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x7f070049</code>, 发现了如下代码</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">    (省略)
    <span style="color: rgb(133, 153, 0);">const</span> v3, <span style="color: rgb(42, 161, 152);">0x7f070049</span>

    invoke-<span style="color: rgb(133, 153, 0);">virtual</span> {v1, v3}, Landroid/content/res/Resources;-&gt;getString(I)Ljava/lang/String;

    move-result-<span style="color: rgb(133, 153, 0);">object</span> v1

    iput-<span style="color: rgb(133, 153, 0);">object</span> v1, v0, Lcom/uc/browser/b/a;-&gt;dpC:Ljava/lang/String;

    :cond_9

    (省略)

    invoke-<span style="color: rgb(133, 153, 0);">virtual</span> {v0, v1}, Lcom/uc/browser/b/a;-&gt;o(Landroid/graphics/drawable/Drawable;)V
    :try_end_2
    .<span style="color: rgb(133, 153, 0);">catch</span> Ljava/lang/Exception; {:try_start_2 .. :try_end_2} :catch_0

    <span style="color: rgb(133, 153, 0);">goto</span>/<span style="color: rgb(42, 161, 152);">16</span> :goto_0
    (省略)</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x7f070049</code>出现之后的一部分代码, 一路看下来, 其实都是在取值赋值, 就拿<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x7f070049</code>来说:</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(203, 75, 22);">#使v3寄存器的值为<span style="color: rgb(42, 161, 152);">0x7f070049</span></span>
    <span style="color: rgb(133, 153, 0);">const</span> v3, <span style="color: rgb(42, 161, 152);">0x7f070049</span><span style="color: rgb(203, 75, 22);">#v1是Resources实例, 调用它的getString方法, 方法的参数是v3中的值</span>
    invoke-<span style="color: rgb(133, 153, 0);">virtual</span> {v1, v3}, Landroid/content/res/Resources;-&gt;getString(I)Ljava/lang/String;
<span style="color: rgb(203, 75, 22);">#将结果存入v1寄存器</span>
    move-result-object v1</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">其实就是我们常用的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">getResources().getString</code><br/>
其实如果一直这么看下去, 会发现毫无头绪, 剩下的代码一直在干差不多的事情, 所以我只截取了这部分, 注意最后一行</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(133, 153, 0);">goto</span>/<span style="color: rgb(42, 161, 152);">16</span> :goto_0</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">也就是说, 有可能代码转到<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">goto_0</code>那儿去了, 那么看看<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">goto_0</code>那里又写了些什么</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">    :goto_0
    (省略)

    <span style="color: rgb(133, 153, 0);">const</span>-string v1, <span style="color: rgb(42, 161, 152);">&quot;window&quot;</span>

    invoke-virtual {v0, v1}, Landroid/content/Context;-&gt;getSystemService(Ljava/lang/String;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/view/WindowManager;

    invoke-<span style="color: rgb(133, 153, 0);">interface</span> {v0}, Landroid/view/WindowManager;-&gt;getDefaultDisplay()Landroid/view/Display;

    move-result-object v0

    invoke-virtual {v0}, Landroid/view/Display;-&gt;getWidth()I

    move-result v0

    iget-object v1, v10, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    iput v0, v1, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;width:I

    iget-object v0, v10, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    invoke-virtual {v10}, Lcom/uc/browser/b/a;-&gt;getContext()Landroid/content/Context;

    move-result-object v1

    invoke-virtual {v1}, Landroid/content/Context;-&gt;getResources()Landroid/content/res/Resources;

    move-result-object v1

    <span style="color: rgb(133, 153, 0);">const</span> v2, <span style="color: rgb(42, 161, 152);">0x7f0d0022</span>

    invoke-virtual {v1, v2}, Landroid/content/res/Resources;-&gt;getDimension(I)F

    move-result v1

    float-to-int v1, v1

    iput v1, v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;height:I

    iget-object v0, v10, Lcom/uc/browser/b/a;-&gt;mWindowManager:Landroid/view/WindowManager;

    iget-object v1, v10, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    invoke-<span style="color: rgb(133, 153, 0);">interface</span> {v0, v10, v1}, Landroid/view/WindowManager;-&gt;addView(Landroid/view/View;Landroid/view/ViewGroup<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;)V</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">其实看到<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">const-string v1, &quot;window&quot;</code>, 我们就应该有所警惕了, 这可能是关键代码了. 为什么这么说? 因为悬浮窗的实现里面, 需要获取<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager</code>, 从而需要调用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Context.getSystemService(Context.WINDOW_SERVICE)</code>, 而官方文档写了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Context.WINDOW_SERVICE</code>就是常量<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">window</code>. 而后我们看到代码中构造了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams</code>, 最终在<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">addView</code>时传入.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">看到这里, 我也觉得很奇怪, 我在<strong style="font-weight: bold;">悬浮窗原理</strong>中写的是我知道的实现悬浮窗的方法, UC的实现好像跟我调用的是相同的API, 也没看到反射之类可能展示奇技淫巧的代码, 为什么UC就可以不需要权限直接显示悬浮窗呢?</p><h2 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24px;">猜测</h2><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">我认为<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">addView</code>的第二个参数<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams</code>可能是关键, 所以我需要知道UC是如何构造这个<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams</code>的.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">由于是系统的类, 无法混淆, 直接搜索<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">LayoutParams</code>就找到了下面的代码</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">iget-<span style="color: rgb(133, 153, 0);">object</span> <span style="color: rgb(181, 137, 0);">v1</span>, <span style="color: rgb(181, 137, 0);">v10</span>, <span style="color: rgb(181, 137, 0);">Lcom/uc/browser/b/a</span>;-&gt;dpx:<span style="color: rgb(181, 137, 0);">Landroid</span>/view/<span style="color: rgb(181, 137, 0);">WindowManager</span>$<span style="color: rgb(181, 137, 0);">LayoutParams</span>;</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这句话就是把<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">v10</code>的值赋给<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">v1</code>, <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">v10</code>是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/a</code>的成员<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">dpx</code>, 那么打开<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/a.smali</code>看看<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">dpx</code>到底是怎么构造的.</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">    (省略)

.field dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    (省略)
    .line <span style="color: rgb(42, 161, 152);">68</span>
    <span style="color: rgb(133, 153, 0);">new</span>-instance v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    invoke-direct {v0}, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;&lt;init&gt;()V

    iput-object v0, p0, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    .line <span style="color: rgb(42, 161, 152);">69</span>
    <span style="color: rgb(133, 153, 0);">if</span>-eqz p2, :cond_0

    .line <span style="color: rgb(42, 161, 152);">70</span>
    iget-object v0, p0, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">16</span> v1, <span style="color: rgb(42, 161, 152);">0x7d5</span>

    iput v1, v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;type:I

    .line <span style="color: rgb(42, 161, 152);">74</span>
    :goto_0
    iget-object v0, p0, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">4</span> v1, <span style="color: rgb(42, 161, 152);">0x1</span>

    iput v1, v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;format:I
    (省略)</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这里的代码就很简单的, 我最先看的是下面这段</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">16</span> v1, <span style="color: rgb(42, 161, 152);">0x7d5</span>

    iput v1, v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;type:I</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这两句代码就是把<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams.type</code>字段设成0x7d5, 官网上写了0x000007d5是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams.TYPE_TOAST</code>的值.</p><h2 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24px;">验证</h2><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">实际测试了一下, 将type设置成TYPE_TOAST果然有奇效, 不需要<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">android.permission.SYSTEM_ALERT_WINDOW</code>权限就能显示一个悬浮窗.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">之前我一直以为调用了系统<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.addView</code>需要<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">android.permission.SYSTEM_ALERT_WINDOW</code>权限, 但实际上调用这个方法是不需要权限的, 在Android源码中有这么一段</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">int</span> <span style="color: rgb(38, 139, 210);">checkAddPermission</span>(WindowManager.LayoutParams attrs) {
    <span style="color: rgb(133, 153, 0);">int</span> type = attrs.type;

    <span style="color: rgb(133, 153, 0);">if</span> (type &lt; WindowManager.LayoutParams.FIRST_SYSTEM_WINDOW
            || type &gt; WindowManager.LayoutParams.LAST_SYSTEM_WINDOW) {
        <span style="color: rgb(133, 153, 0);">return</span> WindowManagerImpl.ADD_OKAY;
    }
    String permission = <span style="color: rgb(133, 153, 0);">null</span>;
    <span style="color: rgb(133, 153, 0);">switch</span> (type) {
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_TOAST:
            <span style="color: rgb(147, 161, 161);">// XXX right now the app process has complete control over</span>
            <span style="color: rgb(147, 161, 161);">// this...  should introduce a token to let the system</span>
            <span style="color: rgb(147, 161, 161);">// monitor/control what they are doing.</span>
            <span style="color: rgb(133, 153, 0);">break</span>;
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_INPUT_METHOD:
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_WALLPAPER:
            <span style="color: rgb(147, 161, 161);">// The window manager will check these.</span>
            <span style="color: rgb(133, 153, 0);">break</span>;
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_PHONE:
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_PRIORITY_PHONE:
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_SYSTEM_ALERT:
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_SYSTEM_ERROR:
        <span style="color: rgb(133, 153, 0);">case</span> TYPE_SYSTEM_OVERLAY:
            permission = android.Manifest.permission.SYSTEM_ALERT_WINDOW;
            <span style="color: rgb(133, 153, 0);">break</span>;
        <span style="color: rgb(133, 153, 0);">default</span>:
            permission = android.Manifest.permission.INTERNAL_SYSTEM_WINDOW;
    }
    <span style="color: rgb(133, 153, 0);">if</span> (permission != <span style="color: rgb(133, 153, 0);">null</span>) {
        <span style="color: rgb(133, 153, 0);">if</span> (mContext.checkCallingOrSelfPermission(permission)
                != PackageManager.PERMISSION_GRANTED) {
            <span style="color: rgb(133, 153, 0);">return</span> WindowManagerImpl.ADD_PERMISSION_DENIED;
        }
    }
    <span style="color: rgb(133, 153, 0);">return</span> WindowManagerImpl.ADD_OKAY;
}</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">可以猜到这个方法是往系统的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager</code>里<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">addView</code>的时候做权限检查用的, 那个<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">type</code>就是我们在构造<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">WindowManager.LayoutParams</code>时赋值的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">type</code>, 可以看到, 除了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>, 其他都是要权限的, 而且非常喜感的是, 代码中的注释还说他们现在对这种type毫无限制, 应该引入标记来限制开发者.</p><h2 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24px;">处理兼容性</h2><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">在这篇文章刚刚公布的时候, 就有同学反馈悬浮窗无法接收事件, 刚开始我并没有特别在意, 在廖祜秋大神做了一个demo之后, 这篇文章阅读量又涨了不少, 随即收到更多反馈事件的问题, 我今天晚上借了台MIUI V5 4.2.2实测了一下, 这台机器上UC的快速搜索功能也无法正常使用.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">在这个ROM上表现为:<br/>
使用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_PHONE</code>这类需要权限的type时, 只有在app处于前台时能显示悬浮窗, 且能正常接受触摸事件. 如果在应用详情里面授悬浮窗权限, 则工作完全正常.<br/>
(这里是MIUI V5对悬浮窗的特殊处理, 现在的ROM, 包括MIUI V6上, 如果不授权, 无法显示任何悬浮窗)<br/>
使用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>这个不需要权限的type时, 悬浮窗正常显示, 但不能接受触摸事件.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">我重新检查了一下smali代码, 发现UC是有分版本处理的, 不过因为smali代码的规则问题, 很难直接看出来, 我把分析过程写出来, 顺便解释一下smali的语法, 供大家以后逆向时拿来参考.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这次我是在OS X上反编译的, 所以变量名可能略有区别.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">接着上面<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/a.smali</code>中查看<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">dpx</code>的构造过程, 代码如下:</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">.field dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

(省略)

<span style="color: rgb(147, 161, 161);"># direct methods</span>
.method <span style="color: rgb(133, 153, 0);">public</span> constructor &lt;init&gt;(Landroid/content/Context;Z)V
    .locals <span style="color: rgb(42, 161, 152);">7</span>

    (省略)

    .line <span style="color: rgb(42, 161, 152);">68</span>
    <span style="color: rgb(133, 153, 0);">new</span>-instance v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    invoke-direct {v0}, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;&lt;init&gt;()V

    iput-object v0, p0, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    .line <span style="color: rgb(42, 161, 152);">69</span>
    <span style="color: rgb(133, 153, 0);">if</span>-eqz p2, :cond_0

    .line <span style="color: rgb(42, 161, 152);">70</span>
    iget-object v0, p0, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">16</span> v1, <span style="color: rgb(42, 161, 152);">0x7d5</span>

    iput v1, v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;type:I</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">为了方便说明, 我遵循smali的规则, 它用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">.line XX</code>, 我们就说这是第XX行的代码.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">上面是我之前分析得到UC使用的是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>的地方, 证据就是第70行的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">const/16 v1, 0x7d5</code>, 但是要知道, smali代码没有跳转的话, 就是从上往下执行, 我们看第69行的代码如下:</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">.line <span style="color: rgb(42, 161, 152);">69</span><span style="color: rgb(133, 153, 0);">if</span>-eqz p2, :cond_0</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这句话的意思是<strong style="font-weight: bold;">如果p2等于0, 控制流跳转到cond_0</strong>, 否则就是继续顺序往下执行. 也就是说UC只有在<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">p2 != 0</code>条件满足的时候才会使用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>, 我们看看<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">cond_0</code>对应的代码.</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">    .line <span style="color: rgb(42, 161, 152);">72</span>
    :cond_0
    iget-object v0, p0, Lcom/uc/browser/b/a;-&gt;dpx:Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;

    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">16</span> v1, <span style="color: rgb(42, 161, 152);">0x7d2</span>

    iput v1, v0, Landroid/view/WindowManager<span style="color: rgb(181, 137, 0);">$LayoutParams</span>;-&gt;type:I</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这里很简单, 就是将<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x7d2</code>赋给了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">type</code>, 官网写了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x000007d2</code>是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_PHONE</code>, 也就是说UC在某种情况下还是会用需要权限的老方法展示悬浮窗.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">现在问题是条件是什么, 关键在<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">p2</code>, 在smali里面, 有两种寄存器命名规则, 一种叫v命名规则, 另一种是p命名规则, 当然只是命名规则而已, 在使用apktool时是可以选的. 这里是p命名规则.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">我刚才分析的赋值过程, 所在的方法是下面这个, 我在刚才的代码片段中也保留了这个部分.</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(203, 75, 22);"># direct methods</span>
.method <span style="color: rgb(133, 153, 0);">public</span> constructor &lt;init&gt;(Landroid/content/Context;Z)V
    .locals <span style="color: rgb(42, 161, 152);">7</span></code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这就是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/a</code>的构造方法, <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">dpx</code>就是在构造方法里初始化的, <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">.locals 7</code>告诉我们这个方法中将出现7个局部寄存器(local register), 名字是v0, v1...v6, 而这个方法的参数有3个, 隐式告诉我们这个方法中将出现3个参数寄存器(parameter register), 名字分别是p0, p1, p2.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">我是怎么知道这个方法有3个参数的呢. smali中非静态方法, 都隐含一个参数p0, 指向自身, 和Java中的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">this</code>是一个意思, 而方法的参数写在括号里, 也就是<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Landroid/content/Context;Z</code>, 其中<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Landroid/content/Context;</code>很明显就是Android中的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Context</code>, 值存储在p1里, 而<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Z</code>对应的是Android中的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">boolean</code>, p2就是他了.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">也就是说, type是用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>还是用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_PHONE</code>, 取决于这个构造方法的第二个参数, 那到底谁构造了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/a</code>呢? 可以去代码里面搜形如<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">new-instance ***, Lcom/uc/browser/b/a;</code>的代码. 更保险的做法是搜<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Lcom/uc/browser/b/a</code>然后一个一个的看.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">我在<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/f.smali</code>里面找到了下面的代码:</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">    .prologue
    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">4</span> v0, <span style="color: rgb(42, 161, 152);">0x0</span>

    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">4</span> v1, <span style="color: rgb(42, 161, 152);">0x1</span>

    (省略)

    <span style="color: rgb(133, 153, 0);">new</span>-instance v3, Lcom/uc/browser/b/a;

    iget-object v4, v9, Lcom/uc/browser/b/e;-&gt;mContext:Landroid/content/Context;

    sget v5, Landroid/os/Build$VERSION;-&gt;SDK_INT:I

    <span style="color: rgb(133, 153, 0);">const</span>/<span style="color: rgb(42, 161, 152);">16</span> v6, <span style="color: rgb(42, 161, 152);">0x13</span>

    <span style="color: rgb(133, 153, 0);">if</span>-lt v5, v6, :cond_0

    move v0, v1

    :cond_0
    invoke-direct {v3, v4, v0}, Lcom/uc/browser/b/a;-&gt;&lt;init&gt;(Landroid/content/Context;Z)V</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这段代码首先是创建了<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">com/uc/browser/b/a</code>的实例, 存储在v3中, 从另一处拿到了一个<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">Context</code>存储在v4中, 然后拿到了当前系统的<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">android.os.Build.VERSION.SDK_INT</code>存储在v5中, 此时将v6的值设为<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">0x13</code>, 千万别粗心看成13了, 我好几次都觉得这是13, 其实是十进制的19, 接下来是一个条件分支, 如果v5的值小于v6, 也就是说<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">android.os.Build.VERSION.SDK_INT &lt; 19</code>, 直接跳转到cond_0, 否则先将v1的值赋给v0, 再顺序执行.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">这句代码</p><pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; display: block; margin: 0px 0px 20px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; background: rgb(253, 246, 227);"><code style="padding: 0px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;">invoke-direct {v3, v4, v0}, Lcom/uc/browser/b/a;-&gt;&lt;init&gt;(Landroid/content/<span style="color: rgb(133, 153, 0);">Context</span>;Z)V</code></pre><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">就是调用v3的构造方法, 参数是v4和v0, 分析一下上面这段代码的逻辑就是:<br/>
如果当前系统API level小于19, 那么第二个参数就是0, 否则就是1.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">而这第二个参数的值就是之前我们分析的p2的值, UC只有在<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">p2 != 0</code>条件满足的时候才会使用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>, 把整个逻辑串起来就是:</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">UC在API level &gt;= 19的时候, 使用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>, 其他情况使用<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_PHONE</code>(需要权限).</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">可能是为了规避在低版本<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, &apos;Courier New&apos;, monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">TYPE_TOAST</code>不能接受事件的问题.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">关于针对源代码的分析, 请看<a href="http://www.jianshu.com/p/634cd056b90c" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">Android悬浮窗使用TYPE_TOAST的小结</a></p><h1 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 26px;">实测效果</h1><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">我之前写的一个app有悬浮窗播放功能, 支持拖动窗口和点击暂停, 关闭窗口等等, 在4.4.4上实测功能正常.</p><div style="margin: 0px auto 20px; text-align: center;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image.gif" type="image/gif" style="max-width: 100%; height: auto; vertical-align: middle; border: 0px; cursor: -webkit-zoom-in; transition: all 0.25s ease-in-out;"/><br/><div style="min-width: 20%; min-height: 22px; display: inline-block; padding: 10px; margin: 0px auto; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(217, 217, 217); font-size: 13px; color: rgb(153, 153, 153); font-style: italic;">无权限悬浮窗演示gif</div></div><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">感谢微博上关注的大神<a href="http://weibo.com/liaohuqiu?from=feed&amp;loc=nickname" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">廖祜秋</a>, 他做了个<a href="https://github.com/liaohuqiu/android-UCToast" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">demo</a>, 虽然交互和UC不同, 可以参考一下实现.<br/></p><div style="margin: 0px auto 20px; text-align: center;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [1].gif" type="image/gif" style="max-width: 100%; height: auto; vertical-align: middle; border: 0px; cursor: -webkit-zoom-in; transition: all 0.25s ease-in-out;"/><br/><div style="min-width: 20%; min-height: 22px; display: inline-block; padding: 10px; margin: 0px auto; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(217, 217, 217); font-size: 13px; color: rgb(153, 153, 153); font-style: italic;">廖祜秋大神的demo</div></div><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">关于这个, 他也写了一篇<a href="http://www.liaohuqiu.net/cn/posts/android-windows-manager/" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">Android 悬浮窗的小结</a></p><h1 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 26px;">其他补充</h1><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">评论区的<em style="font-style: italic;">浮海大虾</em>同学有更多补充如下:</p><blockquote style="padding: 10px 15px; margin: 0px 0px 20px; border-left-width: 4px; border-left-style: solid; border-left-color: rgb(153, 153, 153); word-break: break-word; font-size: 15px; font-weight: 100; background-color: whitesmoke;"><p style="margin: 0px; font-size: 15px; font-weight: normal; text-align: justify; word-break: break-word;">TYPE_TOAST一直都可以显示, 但是用TYPE_TOAST显示出来的在2.3上无法接收点击事件, 因此还是无法随意使用.<br/>
下面是我之前研究后台线程显示对话框的时候记得笔记, 大家可以看看我们项目中有需求需要在后台任务中显示Dialog, 项目最初的做法是用Activity模拟Dialog, 一个Activity已经承载了近20种Dialog, 代码混乱至极. 后来我发现Dialog可以通过改变Window Type实现不依赖Activity显示, 然后就很兴奋的要在使用这种方式来作为新的实现方式.<br/>
最初WindowType是WindowManager.LayoutParams.TYPE_SYSTEM_ALERT, 可是这是悬浮窗了, MIUI会默认禁止(真他妈操蛋，也没有任何提示)最终放弃. 后来试着换成了WindowManager.LayoutParams.TYPE_TOAST, 起初效果很好，MIUI也不禁止了, 哪里都能显示, 这下开心了. 可是后来又发现在2.3上不能接收点击事件, 也就是说Dialog上的按钮不能点击, 这他妈就很操蛋了, 又放弃了. 又试了试其他的Type都不能满足需求, 结果如下：TYPE_SEARCH_BAR: 未知<br/>
TYPE_ACCESSIBILITY_OVERLAY: 拒绝使用<br/>
TYPE_APPLICATION: 只能配合Activity在当前APP使用TYPE_APPLICATION_ATTACHED_DIALOG: 只能配合Activity在当前APP使用<br/>
TYPE_APPLICATION_MEDIA: 无法使用(什么也不显示)<br/>
TYPE_APPLICATION_PANEL: 只能配合Activity在当前APP使用(PopupWindow默认就是这个Type)<br/>
TYPE_APPLICATION_STARTING: 无法使用(什么也不显示)<br/>
TYPE_APPLICATION_SUB_PANEL: 只能配合Activity在当前APP使用TYPE_BASE_APPLICATION: 无法使用(什么也不显示)<br/>
TYPE_CHANGED: 只能配合Activity在当前APP使用<br/>
TYPE_INPUT_METHOD: 无法使用(直接崩溃)<br/>
TYPE_INPUT_METHOD_DIALOG: 无法使用(直接崩溃)<br/>
TYPE_KEYGUARD_DIALOG: 拒绝使用<br/>
TYPE_PHONE: 属于悬浮窗(并且给一个Activity的话按下HOME键会出现看不到桌面上的图标异常情况)<br/>
TYPE_TOAST: 不属于悬浮窗, 但有悬浮窗的功能, 缺点是在Android2.3上无法接收点击事件<br/>
TYPE_SYSTEM_ALERT: 属于悬浮窗, 但是会被禁止</p></blockquote><h1 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 26px;">尾声</h1><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">现在我们都知道了如何在不申请权限的情况下显示悬浮窗, 我相信以中国Android开发者的脑洞, 一定会有很多有趣或恶心的功能被开发出来, 一方面我自己觉得这个东西很有用, 可以实现一些很神奇的功能, 另一方面又担心这个API被滥用, 最终不得不限制权限.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;">还有就是, 逆向分析仅用于学习, 不要干违法的事情.</p><p style="margin: 0px 0px 25px; text-align: justify; word-break: break-word;"><em style="font-style: italic;">本人技术有限, 如果文中有错误的欢迎指正, 以免误导他人</em></p><blockquote style="padding: 10px 15px; margin: 0px 0px 20px; border-left-width: 4px; border-left-style: solid; border-left-color: rgb(153, 153, 153); word-break: break-word; font-size: 15px; font-weight: 100; background-color: whitesmoke;"><p style="margin: 0px; font-size: 15px; font-weight: normal; text-align: justify; word-break: break-word;">利益声明: 虽然我目前在UC实习, 但我并没有UC浏览器中文版的代码权限, 也不会将公司的代码分享给外人. 本文完全是靠我自己开发经验+逆向分析经验+Google完成, 在此之前没有看过UC浏览器的任何代码.</p></blockquote></div></div></div><div style="width: 620px; margin: 0px auto 50px; font-size: 12px; color: rgb(213, 213, 213);"><div><a href="http://www.jianshu.com/sign_in" style="color: rgb(153, 153, 153); text-decoration: none;"> 推荐拓展阅读</a></div><div style="float: right;"><div style="float: right; margin: -20px 0px 0px 20px;"><a style="color: rgb(153, 153, 153); text-decoration: none;"> 著作权归作者所有</a></div></div></div><div style="padding: 25px; margin: 0px auto 40px; border-left-width: 4px; border-left-style: solid; border-left-color: rgb(245, 126, 66); box-sizing: border-box; box-shadow: rgb(217, 217, 217) 0px 0px 1px; width: 620px; background-color: whitesmoke;"><p style="margin: 0px auto 10px; font-size: 17px; font-weight: bold;">如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！</p><a href="http://www.jianshu.com/p/167fd5f47d5c#pay-modal" style="color: white; text-decoration: none; display: inline-block; padding: 4px 12px; margin: 10px 15px 10px 0px; font-size: 14px; text-align: center; vertical-align: middle; cursor: pointer; text-shadow: none; border: 1px solid rgb(245, 126, 66); border-radius: 4px; box-shadow: none; background: rgb(245, 126, 66);">¥ 打赏支持</a> </div><div style="width: 620px; margin: 0px auto 40px;"><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; float: left; width: 163px; height: 50px; overflow: hidden; border: 1px solid rgb(231, 129, 112); border-radius: 40px; font-size: 18px; text-align: center;"><div style="position: relative; width: 60px; height: 50px; padding-right: 10px; display: inline-block;"><a href="http://www.jianshu.com/sign_in" style="color: rgb(231, 129, 112); text-decoration: none; position: absolute; left: 0px; transition: all 0.2s cubic-bezier(0.35, 0.32, 0.4, 1.18);"> 喜欢</a></div>
 <span style="color: rgb(231, 129, 112); position: relative; top: -19px; height: 20px; padding-left: 15px; border-left-width: 1px; border-left-style: solid; cursor: pointer;">122</span></div><div style="float: right; margin-top: 16px;"><a style="color: rgb(85, 85, 85); text-decoration: none; margin-right: 8px; font-size: 18px;"><span style="margin-left: 5px; font-size: 14px;">分享到微博</span> </a><a href="http://www.jianshu.com/p/167fd5f47d5c#share-weixin-modal" style="color: rgb(85, 85, 85); text-decoration: none; margin-right: 8px; font-size: 18px;"><span style="margin-left: 5px; font-size: 14px;">分享到微信</span> </a><div style="position: relative; display: inline-block;"><a style="color: rgb(85, 85, 85); text-decoration: none;">更多分享</a></div></div></div><div style="opacity: 1 !important; transition: opacity 0.3s linear, top 0.3s ease-out; position: fixed; top: 0px; left: 0px; z-index: 1050; width: auto; margin: 0px; border: none; border-radius: 6px; box-shadow: none; -webkit-background-clip: padding-box; outline: 0px; display: block !important; font-size: 14px; font-weight: normal; overflow: hidden; right: 0px; bottom: 0px; transform: scale(0); padding-left: 90px; text-align: center; background-color: transparent; background-clip: padding-box;"><div style="position: relative; width: 600px; margin: 30px auto;"><div style="position: relative; background-clip: padding-box;"><div style="padding: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"><h3 style="margin: 0px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 24.5px;">喜欢的用户</h3></div><div style="position: relative; overflow-y: auto; max-height: none; padding: 30px 10px;"><ul style="padding: 0px; margin: 0px 0px 10px; list-style: none;"><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/44894290b3ed" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image.png" type="image/png" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/44894290b3ed" style="color: rgb(64, 148, 199); text-decoration: none;">男子汉大豆腐</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.03.03 10:37</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/9a5b64d714d3" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [2].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/9a5b64d714d3" style="color: rgb(64, 148, 199); text-decoration: none;">DubeStepForward</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.02.26 19:23</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/b4abab9dd52f" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [3].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/b4abab9dd52f" style="color: rgb(64, 148, 199); text-decoration: none;">小鹏先生</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.02.23 22:34</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/2eb56199844d" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [4].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/2eb56199844d" style="color: rgb(64, 148, 199); text-decoration: none;">fewwind</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.02.22 17:21</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/f080cf122583" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [5].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/f080cf122583" style="color: rgb(64, 148, 199); text-decoration: none;">公子孤族</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.02.19 22:54</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/77cf961197c9" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [6].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/77cf961197c9" style="color: rgb(64, 148, 199); text-decoration: none;">冰冰的冻结</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.01.23 23:59</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/cb245848f4e2" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [1].png" type="image/png" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/cb245848f4e2" style="color: rgb(64, 148, 199); text-decoration: none;">cb245848f4e2</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.01.11 11:03</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/9e23a5e93440" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [7].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/9e23a5e93440" style="color: rgb(64, 148, 199); text-decoration: none;">沙滩海风</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2016.01.08 08:16</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/abe3f709e800" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [8].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/abe3f709e800" style="color: rgb(64, 148, 199); text-decoration: none;">coding_trick</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.30 16:49</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/ab4d289d8e2a" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [2].png" type="image/png" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/ab4d289d8e2a" style="color: rgb(64, 148, 199); text-decoration: none;">哎哟陈先生</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.23 16:09</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/fdb4aa8fa290" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [9].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/fdb4aa8fa290" style="color: rgb(64, 148, 199); text-decoration: none;">李飞扬</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.15 16:17</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/de24acb3d7b4" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [10].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/de24acb3d7b4" style="color: rgb(64, 148, 199); text-decoration: none;">风中沙</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.14 09:52</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/3d24b05a7637" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [11].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/3d24b05a7637" style="color: rgb(64, 148, 199); text-decoration: none;">Robert_Zhang</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.08 17:29</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/2d589fdebba5" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [12].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/2d589fdebba5" style="color: rgb(64, 148, 199); text-decoration: none;">某某某某某某晋</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.08 15:53</span></li><li style="padding: 10px 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); overflow: hidden; text-align: left;"><a href="http://www.jianshu.com/users/37fab3d672ce" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 30px; height: 30px; display: inline-block; margin-right: 5px; border: 1px solid rgb(217, 217, 217);"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [13].jpg" type="image/jpeg" style="max-width: 100%; height: 30px; vertical-align: middle; border: none; width: 30px; border-radius: 50%; box-sizing: border-box;"/></a> <a href="http://www.jianshu.com/users/37fab3d672ce" style="color: rgb(64, 148, 199); text-decoration: none;">h4de5</a><span style="float: right; margin-top: 9px; color: rgb(153, 153, 153); font-size: 12px;">2015.12.06 10:41</span></li></ul></div></div></div></div><div style="width: 620px; margin: 0px auto 35px;"><div style="margin-bottom: 25px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(238, 238, 238); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(153, 153, 153); font-size: 12px; font-weight: normal;">47条评论 （ <a style="color: rgb(85, 85, 85); text-decoration: none; margin: 0px 5px;">按时间正序</a>· <a style="color: rgb(153, 153, 153); text-decoration: none; margin: 0px 5px;">按时间倒序</a>· <a style="color: rgb(153, 153, 153); text-decoration: none; margin: 0px 5px;">按喜欢排序</a> ）<a href="http://www.jianshu.com/sign_in" style="color: rgb(153, 153, 153); text-decoration: none; float: right; margin: 0px 5px;">添加新评论</a></div><div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/71d8dbe721e5" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [14].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/71d8dbe721e5" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">ChadCSong</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">2 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/750294#comment-750294" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.16 22:26</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">好文。对于权限管理来说，Android还有很长的路要走啊</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/e3d94ec0f44a" style="color: rgb(64, 148, 199); text-decoration: none;">陆叔叔</a>： <a href="http://www.jianshu.com/users/71d8dbe721e5" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@ChadCSong</a> 我觉得 moto 手机权限管理用的非常顺手，很方便</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/776652#comment-776652" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 10:50</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);"><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/52c6e7251d21" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [15].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/52c6e7251d21" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">浮游大虾</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">3 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/750408#comment-750408" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.16 22:44</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">TYPE_TOAST一直都可以显示，但是用TYPE_TOAST显示出来的在2.3上无法接收点击事件，因此还是无法随意使用，下面是我之前研究后台线程显示对话框的时候记得笔记，大家可以看看<br/><br/>
我们项目中有需求需要在后台任务中显示Dialog，项目最初的做法是用Activity模拟Dialog，一个Activity已经承载了近20种Dialog，代码混乱至极。<br/><br/>
后来我发现Dialog可以通过改变Window Type实现不依赖Activity显示，然后就很兴奋的要在使用这种方式来作为新的实现方式。<br/><br/>
最初WindowType是WindowManager.LayoutParams.TYPE_SYSTEM_ALERT，可是这是悬浮窗了，MIUI会默认禁止（真他妈操蛋，也没有任何提示）最终放弃。<br/><br/>
后来试着换成了WindowManager.LayoutParams.TYPE_TOAST，起初效果很好，MIUI也不禁止了，哪里都能显示，这下开心了。可是后来又发现在2.3上不能接收点击事件，也就是说Dialog上的按钮不能点击，这他妈就很操蛋了，又放弃了。<br/><br/>
又试了试其他的Type都不能满足需求，结果如下：<br/>
TYPE_SEARCH_BAR：未知<br/>
TYPE_ACCESSIBILITY_OVERLAY：拒绝使用<br/>
TYPE_APPLICATION：只能配合Activity在当前APP使用<br/>
TYPE_APPLICATION_ATTACHED_DIALOG：只能配合Activity在当前APP使用<br/>
TYPE_APPLICATION_MEDIA：无法使用（什么也不显示）<br/>
TYPE_APPLICATION_PANEL：只能配合Activity在当前APP使用（PopupWindow默认就是这个Type）<br/>
TYPE_APPLICATION_STARTING：无法使用（什么也不显示）<br/>
TYPE_APPLICATION_SUB_PANEL：只能配合Activity在当前APP使用<br/>
TYPE_BASE_APPLICATION：无法使用（什么也不显示）<br/>
TYPE_CHANGED：只能配合Activity在当前APP使用<br/>
TYPE_INPUT_METHOD：无法使用（直接崩溃）<br/>
TYPE_INPUT_METHOD_DIALOG：无法使用（直接崩溃）<br/>
TYPE_KEYGUARD_DIALOG：拒绝使用<br/>
TYPE_PHONE：属于悬浮窗（并且给一个Activity的话按下HOME键会出现看不到桌面上的图标异常情况）<br/>
TYPE_TOAST：不属于悬浮窗，但有悬浮窗的功能，缺点是在Android2.3上无法接收点击事件<br/>
TYPE_SYSTEM_ALERT：属于悬浮窗，但是会被禁止</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/52c6e7251d21" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@浮游大虾</a> 非常感谢分享</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/750457#comment-750457" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.16 22:54</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/52c6e7251d21" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@浮游大虾</a> 我补充了对UC兼容性处理的逆向分析, UC在19及以上才会用TYPE_TOAST</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/775544#comment-775544" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 01:43</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/3aaa7b3056f0" style="color: rgb(64, 148, 199); text-decoration: none;">廖祜秋liaohuqiu_秋百</a>： <a href="http://www.jianshu.com/users/52c6e7251d21" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@浮游大虾</a> <br/><br/>
“TYPE_SYSTEM_ALERT：属于悬浮窗，但是会被禁止”<br/><br/>
这个会被禁止是指被什么禁止？<br/></p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/775640#comment-775640" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 06:00</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);">还有 2 条评论， <a style="color: rgb(64, 148, 199); text-decoration: none;">展开查看</a><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/ff0ed03a05f5" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [16].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/ff0ed03a05f5" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">ningso</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">4 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/751434#comment-751434" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 08:32</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">nice</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/80e7b1fee690" style="color: rgb(64, 148, 199); text-decoration: none;">裸奔的凯子哥</a>： <a href="http://www.jianshu.com/users/ff0ed03a05f5" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@ningso</a> hallow 哇</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/787647#comment-787647" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.24 16:52</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/ff0ed03a05f5" style="color: rgb(64, 148, 199); text-decoration: none;">ningso</a>： <a href="http://www.jianshu.com/users/80e7b1fee690" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@裸奔的凯子哥</a> 😂😂被凯子在这活捉了吗？</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/787667#comment-787667" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.24 16:56</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);"><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/dc3c55295cf5" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [17].jpg" type="image/jpeg" alt="6" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/dc3c55295cf5" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">CntChen</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">5 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/751506#comment-751506" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 08:53</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">好文章</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/xSHJs6" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [18].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/xSHJs6" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">风语安然</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">6 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/751741#comment-751741" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 10:05</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">好棒,跟博主学习到了.</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/21e4ef158480" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [19].jpg" type="image/jpeg" alt="7" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/21e4ef158480" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">谭冉冉</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">7 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/752131#comment-752131" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 11:18</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">既然不能接收接收点击事件，那么UC 和金山又是怎样做到的呢？</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/21e4ef158480" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@tanranran</a> 我没有在2.3上测过UC的相关功能，手头也没有设备，有个方法是看下UC的代码里有没有判断api版本，毕竟2.3时代的机器很多都没有管理悬浮窗权限的，直接申请权限也无妨</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/752258#comment-752258" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 11:59</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/21e4ef158480" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@tanranran</a> 我测了一下UC在MIUI V5 4.2.2上的表现, 它即便是在授权的情况下悬浮窗也出不来</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/774772#comment-774772" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 22:46</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/21e4ef158480" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@tanranran</a> 我补充了对UC兼容性处理的逆向分析, UC在19及以上才会用TYPE_TOAST</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/775545#comment-775545" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 01:43</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);"><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/915456d2544a" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [20].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/915456d2544a" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">tao</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">8 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/752358#comment-752358" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 12:35</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">厉害，学到了</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/c0a73bee4318" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [21].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/c0a73bee4318" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">jasonkxs</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">9 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/756237#comment-756237" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.17 23:27</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">厉害~~~学习了~</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/5efe86cf1426" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [22].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/5efe86cf1426" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">空指针</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">10 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/766160#comment-766160" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.20 09:45</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">分析的过程很赞~</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/a058d760eb74" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [23].jpg" type="image/jpeg" alt="8" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/a058d760eb74" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">nanbabao</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">11 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/766359#comment-766359" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.20 10:35</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">分析有理有据</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/f4324330f07f" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [24].jpg" type="image/jpeg" alt="13" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/f4324330f07f" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">流星悄悄划过</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">12 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/768933#comment-768933" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.20 20:53</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">学到了,学到了,</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(1)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/2f1c0190679d" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [3].png" type="image/png" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/2f1c0190679d" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">塔塔酱</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">13 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/771696#comment-771696" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 12:24</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">以前做LockScreen的时候也是用类似的技巧强制把窗体弄到最上面的</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/2f1c0190679d" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@塔塔酱</a> 如果是假锁屏还是不建议用悬浮窗，毕竟home键监听不到</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/771726#comment-771726" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 12:28</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/2f1c0190679d" style="color: rgb(64, 148, 199); text-decoration: none;">塔塔酱</a>： <a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@Shawon</a> LockScreen中Home按键是被屏蔽掉的，算是“真·锁屏”了吧。</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/771737#comment-771737" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 12:30</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);"><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/9084a7fd2516" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [4].png" type="image/png" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/9084a7fd2516" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">BarryJ</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">14 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/773070#comment-773070" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 17:15</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">验证了下，在MIUI V5上是不可行的（悬浮窗只显示在应用内，按home键后就见不到悬浮窗了，还不能响应点击事件），在MIUI V6上就畅通无阻~顺便说下我实验的MIUI V5所属Android版本是4.1.3，看来像是和API level无关</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/9084a7fd2516" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@BarryJ</a> 我手头也只有一部MIUI V6可以测试, 不了解其他手机上的情况, 在github上廖大神写了个demo, 和UC的交互不同, 不过实现是一样的<a href="https://github.com/liaohuqiu/android-UCToast" rel="nofollow" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">https://github.com/liaohuqiu/android-UCToast</a> 可以和廖大神讨论讨论</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/773225#comment-773225" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 17:52</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/9084a7fd2516" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@BarryJ</a> 我找了台MIUI V5 4.2.2的机器, 如果是正常的SYSTEM_ALERT_WINDOW, 授权后正常工作, 如果是TYPE_TOAST, 虽然能显示, 但是无法接受事件</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/774753#comment-774753" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 22:43</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/9084a7fd2516" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@BarryJ</a> 我补充了对UC兼容性处理的逆向分析, UC在19及以上才会用TYPE_TOAST</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/775547#comment-775547" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 01:43</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);">还有 5 条评论， <a style="color: rgb(64, 148, 199); text-decoration: none;">展开查看</a><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/dc193e46be3f" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [25].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/dc193e46be3f" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">freefaces</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">15 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/773786#comment-773786" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 19:57</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">在我在真机nexus s 4.1.2上点击没反应，但是三星n7100 4.1.2 可以。genymotion 的模拟器API19 以下点击没反应。</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(0)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div><div style="padding-bottom: 30px; margin-top: 10px; border-top-width: 1px; border-top-style: dashed; border-top-color: rgb(238, 238, 238);"><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/dc193e46be3f" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@freefaces</a> 感觉这个悬浮窗还是有一些坑要处理的...你运行的是廖大神的demo么</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/773840#comment-773840" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.21 20:05</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;">Shawon</a>： <a href="http://www.jianshu.com/users/dc193e46be3f" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@freefaces</a> 我补充了对UC兼容性处理的逆向分析, UC在19及以上才会用TYPE_TOAST</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/775548#comment-775548" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 01:43</a></span></div></div><div style="padding: 15px 0px 15px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217); border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); font-size: 13px;"><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/dc193e46be3f" style="color: rgb(64, 148, 199); text-decoration: none;">freefaces</a>： <a href="http://www.jianshu.com/users/d1d4064c69c7" style="color: rgb(64, 148, 199); text-decoration: none;" target="_blank">@Shawon</a> 嗯，API 19以上就是OK的了。我自己也做一个跟悬浮窗有关系的东西。bugtags.com，本来打算用一下这个黑科技，后来还是发现暂时没法生产上用。</p><div style="text-align: right;"><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a><span style="float: left; margin-top: 3px; font-size: 12px; color: rgb(153, 153, 153);"><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/776549#comment-776549" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 10:25</a></span></div></div><div style="padding: 20px 0px 15px 10px; border-left-width: 3px; border-left-style: solid; border-left-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(238, 238, 238); font-size: 13px; color: rgb(153, 153, 153);">还有 1 条评论， <a style="color: rgb(64, 148, 199); text-decoration: none;">展开查看</a><span style="float: right;"><a style="color: rgb(85, 85, 85); text-decoration: none;"> 添加新回复</a></span></div></div></div></div><div style="margin-bottom: 20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); font-size: 16px;"><div><div style="font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; margin: 0px 0px 10px; padding-top: 10px;"><a href="http://www.jianshu.com/users/c9579b794cf5" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; width: 35px; height: 35px; display: inline-block; margin-right: 10px; float: left;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [26].jpg" type="image/jpeg" alt="100" style="max-width: 100%; height: 35px; vertical-align: middle; border: none; width: 35px; border-radius: 50%; box-sizing: border-box;"/></a><p style="margin: 0px; word-break: break-all; word-wrap: break-word;"><a href="http://www.jianshu.com/users/c9579b794cf5" style="color: rgb(64, 148, 199); text-decoration: none; font-size: 14px;">LITTLEDREAM</a></p><span style="position: relative; top: 1px; margin-right: 10px; font-size: 12px; color: rgb(153, 153, 153); margin-top: 3px;"><small style="font-size: 12px;">16 楼 · </small><a href="http://www.jianshu.com/p/167fd5f47d5c/comments/776666#comment-776666" style="color: rgb(177, 177, 177); text-decoration: none;">2015.10.22 10:53</a></span></div><p style="margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word;">smali雖然看得不是太懂，但是還將就。之前自己自定義過Toast，但是當時沒有考慮到這麼細，還是博主厲害啊！</p><div style="text-align: right; margin-bottom: 10px;"><a style="color: rgb(153, 153, 153); text-decoration: none; float: left; font-size: 13px; margin-top: 5px;">喜欢(1)</a><a style="color: rgb(153, 153, 153); text-decoration: none; font-size: 13px; margin-left: 14px;">回复</a></div></div></div><p style="margin: 0px; text-align: center; padding: 10px 0px; font-size: 12px;"><a href="http://www.jianshu.com/notes/2254091/comments?max_id=1030647&amp;order=asc&amp;page=2" style="color: rgb(64, 148, 199); text-decoration: none;">加载更多 </a></p></div><p style="margin: 0px 0px 10px; text-align: center;"><a href="http://www.jianshu.com/sign_in" style="color: white; text-decoration: none; display: inline-block; padding: 4px 12px; margin-bottom: 0px; font-size: 14px; text-align: center; vertical-align: middle; cursor: pointer; text-shadow: none; border: 1px solid rgb(21, 167, 240); border-radius: 4px; box-shadow: none; background: rgb(21, 167, 240);">登录后发表评论</a></p></div></div><div style="position: relative; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(217, 217, 217); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: whitesmoke; z-index: 2; background-color: whitesmoke;"><div style="width: 620px; margin-top: 40px; margin-right: auto; margin-left: auto;"><h5 style="margin: 0px 0px 15px; font-family: inherit; font-weight: normal; color: rgb(153, 153, 153); text-rendering: optimizeLegibility; font-size: 13px;">被以下专题收入，发现更多相似内容：</h5><ul style="padding: 0px; margin: 0px 0px 10px; list-style: none;"><li style="padding: 15px 0px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217);"><a href="http://www.jianshu.com/collection/bDHhpK" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; float: left; width: 40px; height: 40px;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [27].jpg" type="image/jpeg" alt="180" style="max-width: 100%; height: 40px; vertical-align: middle; border: none; width: 40px; border-radius: 50%; box-sizing: border-box;"/></a><div style="position: relative; margin-left: 55px;"><h5 style="margin: 0px 0px 3px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 14px;"><a href="http://www.jianshu.com/collection/bDHhpK" style="color: rgb(85, 85, 85); text-decoration: none;">首页投稿</a></h5><div style="display: inline-block; padding: 2px 10px 0px; margin-bottom: 0px; font-size: 12px; text-align: center; vertical-align: middle; cursor: pointer; color: white; text-shadow: none; border: 1px solid rgb(73, 190, 56); border-radius: 50px; box-shadow: none; font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-weight: normal; position: absolute; right: 0px; top: 43px; margin-top: -13px; background: rgb(73, 190, 56);"><a href="http://www.jianshu.com/sign_in" style="color: white; text-decoration: none;"> <span style="padding-left: 7px; margin-left: 3px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(217, 217, 217);">添加关注</span></a></div><p style="margin: 0px 0px 3px; color: rgb(153, 153, 153); font-size: 12px; padding-right: 120px;">玩转简书的第一步，从这个专题开始。 想上首页热门榜么？好内容想被更多人看到么？来投稿吧！如果被拒也不要灰心哦～入选文章会进一个队...</p><p style="margin: 0px; color: rgb(153, 153, 153); font-size: 11px;"><a href="http://www.jianshu.com/collection/bDHhpK" style="color: rgb(64, 148, 199); text-decoration: none;">36963篇文章</a> · 77320人关注</p></div></li><li style="padding: 15px 0px 10px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(217, 217, 217);"><a href="http://www.jianshu.com/collection/NEt52a" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; float: left; width: 40px; height: 40px;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [28].jpg" type="image/jpeg" alt="180" style="max-width: 100%; height: 40px; vertical-align: middle; border: none; width: 40px; border-radius: 50%; box-sizing: border-box;"/></a><div style="position: relative; margin-left: 55px;"><h5 style="margin: 0px 0px 3px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 14px;"><a href="http://www.jianshu.com/collection/NEt52a" style="color: rgb(85, 85, 85); text-decoration: none;">程序员</a></h5><div style="display: inline-block; padding: 2px 10px 0px; margin-bottom: 0px; font-size: 12px; text-align: center; vertical-align: middle; cursor: pointer; color: white; text-shadow: none; border: 1px solid rgb(73, 190, 56); border-radius: 50px; box-shadow: none; font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-weight: normal; position: absolute; right: 0px; top: 43px; margin-top: -13px; background: rgb(73, 190, 56);"><a href="http://www.jianshu.com/sign_in" style="color: white; text-decoration: none;"> <span style="padding-left: 7px; margin-left: 3px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(217, 217, 217);">添加关注</span></a></div><p style="margin: 0px 0px 3px; color: rgb(153, 153, 153); font-size: 12px; padding-right: 120px;">简书程序员大本营 投稿须知： 1.本专题仅收录与程序有关的文章。 2.请在代码框里写代码，尽量保证可看性。</p><p style="margin: 0px; color: rgb(153, 153, 153); font-size: 11px;"><a href="http://www.jianshu.com/collection/NEt52a" style="color: rgb(64, 148, 199); text-decoration: none;">6887篇文章</a> · 60688人关注</p></div></li><li style="padding: 15px 0px 10px; border-bottom-style: none;"><a href="http://www.jianshu.com/collection/V2CqjW" style="color: rgb(85, 85, 85); text-decoration: none; border-radius: 50%; float: left; width: 40px; height: 40px;"><img src="Android无需权限显示悬浮窗, 兼谈逆向分析app httpwww.jianshu.c_files/Image [29].jpg" type="image/jpeg" alt="180" style="max-width: 100%; height: 40px; vertical-align: middle; border: none; width: 40px; border-radius: 50%; box-sizing: border-box;"/></a><div style="position: relative; margin-left: 55px;"><h5 style="margin: 0px 0px 3px; font-family: inherit; font-weight: bold; color: inherit; text-rendering: optimizeLegibility; font-size: 14px;"><a href="http://www.jianshu.com/collection/V2CqjW" style="color: rgb(85, 85, 85); text-decoration: none;">@IT</a></h5><div style="display: inline-block; padding: 2px 10px 0px; margin-bottom: 0px; font-size: 12px; text-align: center; vertical-align: middle; cursor: pointer; color: white; text-shadow: none; border: 1px solid rgb(73, 190, 56); border-radius: 50px; box-shadow: none; font-family: &apos;lucida grande&apos;, &apos;lucida sans unicode&apos;, lucida, helvetica, &apos;Hiragino Sans GB&apos;, &apos;Microsoft YaHei&apos;, &apos;WenQuanYi Micro Hei&apos;, sans-serif; font-weight: normal; position: absolute; right: 0px; top: 43px; margin-top: -13px; background: rgb(73, 190, 56);"><a href="http://www.jianshu.com/sign_in" style="color: white; text-decoration: none;"> <span style="padding-left: 7px; margin-left: 3px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(217, 217, 217);">添加关注</span></a></div><p style="margin: 0px 0px 3px; color: rgb(153, 153, 153); font-size: 12px; padding-right: 120px;">简书上的IT大社群。 管理员由 简书@IT社群 不定期轮换当班。 入选本专题的文章，且通过首页投稿审核，则会进入简书首页 ...</p><div style="margin: 0px; color: rgb(153, 153, 153); font-size: 11px;"><a href="http://www.jianshu.com/collection/V2CqjW" style="color: rgb(64, 148, 199); text-decoration: none;">3514篇文章</a> · 21021人关注</div></div></li></ul></div></div></div></span>
</div></body></html> 