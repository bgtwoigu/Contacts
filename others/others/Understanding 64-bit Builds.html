<html>
<head>
  <title>Understanding 64-bit Builds</title>
  <basefont face="Microsoft YaHei" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (zh-CN); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: Microsoft YaHei;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1244"/>
<h1>Understanding 64-bit Builds</h1>

<div>
<span><div style="padding: 2.2em 0px 0.2em; color: rgb(34, 34, 34); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px auto; width: 940px; clear: both; transition: all 0.25s ease-out; max-width: 940px; height: 41px; border-bottom-width: 1px; border-bottom-style: solid; border-color: rgb(204, 204, 204); position: relative;"><div style="display: inline; float: left; margin: -3px 30px 0px 0px; width: 140px; padding-right: 0px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204);"><a href="http://source.android.com/index.html" style="color: rgb(37, 138, 175); text-decoration: none;"><img alt="Android Open Source Project" height="25" src="http://source.android.com/assets/images/sac_logo.png" style="border: 0px; vertical-align: middle; max-width: 100%;" width="123"></img></a></div><ul style="margin: -2px 10px 0px 0px; padding: 0px; display: inline; float: left; width: 520px; list-style-type: none;"><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/source/index.html" style="color: rgb(51, 181, 229); text-decoration: none; font-size: 16px;">Source</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/devices/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Devices</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/security/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Security</a></li><li style="margin: 0px 45px 5px 0px; display: block; float: left; transition: all 0.25s linear;"><a href="http://source.android.com/compatibility/index.html" style="color: rgb(51, 51, 51); text-decoration: none; font-size: 16px;">Compatibility</a></li></ul><div style="position: absolute; right: 6px; top: -9px; width: 40px; height: 35px; z-index: 99; overflow: hidden; opacity: 0; transform-origin: 100% 0% 0px; transition-property: -webkit-opacity; transition-duration: 0.25s; transition-timing-function: ease;"><div style="width: 228px; padding: 10px 20px 0px; background: url(http://source.android.com/assets/images/more_mid.png) repeat-y;"><div style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); font-weight: bold;">Android Sites</div><ul style="margin: 10px 10px 20px 0px; padding: 0px;"><li><a style="color: rgb(34, 34, 34) !important;">Android Open Source Project</a><a href="http://www.android.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android.com</a><a href="http://developer.android.com/" style="color: rgb(37, 138, 175); text-decoration: none;">Android Developers</a></li></ul><br/></div></div></div></div><div style="margin: 0px auto; width: 940px; clear: both; color: rgb(34, 34, 34); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="display: inline; float: left; margin-left: 0px; margin-right: 10px; width: 220px; min-height: 5px; margin-bottom: 1px; overflow: hidden;"><div style="outline: none; width: 220px; margin: 20px 0px 0px; overflow: hidden; padding: 0px; height: 922px;"><div style="overflow: hidden; position: relative; width: 220px; height: 922px;"><div style="position: absolute; overflow: hidden; width: 220px; padding: 0px; top: 0px;"><ul style="margin: 0px; padding: 0px 0px 30px; width: 216px;"><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/index.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Overview</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/requirements.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Downloading and Building</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px; background: rgba(0, 0, 0, 0.0470588);"><a href="http://source.android.com/source/developing.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Developing</a></div></li><li style="list-style: none; display: inline"><ul style="margin: 0px; padding: 0px; display: block; overflow: hidden;"><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/using-repo.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Using Repo</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/git-resources.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Learning Git</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/add-device.html" style="color: rgb(85, 85, 85); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Adding a New Device</a></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px 0px 5px; background: rgba(0, 0, 0, 0.027451);"><a href="http://source.android.com/source/64-bit-builds.html" style="color: rgb(0, 153, 204); text-decoration: none; word-wrap: break-word; display: block; font-weight: normal; text-transform: none; padding: 7px 5px 7px 10px;">Understanding 64-bit Builds</a></li></ul></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/contributing.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Contributing</a></div></li><li style="margin: 0px; list-style-type: none; font-size: 14px; padding: 0px;"><div style="position: relative; margin-bottom: 1px; padding: 0px 30px 0px 0px;"><a href="http://source.android.com/source/community.html" style="color: rgb(51, 51, 51); text-decoration: none; word-wrap: break-word; display: block; font-weight: 500; padding: 10px 0px 10px 10px;">Community</a></div></li></ul></div></div></div></div><div style="display: inline; float: left; margin-left: 10px; margin-right: 0px; width: 700px;"><h1 style="color: rgb(51, 51, 51); font-size: 34px; margin: 36px 0px 27px; padding: 0px 0px 10px; font-weight: 300;">Understanding 64-bit Builds</h1><div><div style="float: right; clear: right; margin: -27px 0px 0px 20px; padding: 0px 0px 20px;"><div style="font-size: 13px; width: 238px; border: 1px solid rgb(204, 204, 204); float: right;"><h2 style="color: rgb(51, 51, 51); font-size: inherit; margin: 10px 15px; padding: 0px; font-weight: 300; text-transform: uppercase; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: gainsboro;">IN THIS DOCUMENT</h2><ol style="margin: 0px 15px 15px; padding: 0px; font-size: inherit; list-style: none;"><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#overview" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Overview</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#product_configuration" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Product Configuration</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#module_definition_in_android_mk" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Module Definition in Android.mk</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#install_path" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Install path</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#generated_sources" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Generated sources</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#prebuilts" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Prebuilts</a></li><li style="margin: 0px 0px 5px; font-size: inherit;"><a href="http://source.android.com/source/64-bit-builds.html#dex-preopt" style="color: rgb(37, 138, 175); text-decoration: none; font-size: inherit;">Dex-preopt</a></li></ol></div></div><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Overview</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">From the build system’s perspective, the most prominent change is that now it supports building binaries for two target CPU architectures (64-bit and 32-bit) in the same build. That’s also known as <em style="font-style: italic;">Multilib build</em>.</p><p style="margin: 0px 0px 15px;">For native static libraries and shared libraries, the build system sets up rules to build binaries for both architectures. The product configuration (PRODUCT_PACKAGES), together with the dependency graph, determines which binaries are built and installed to the system image.</p><p style="margin: 0px 0px 15px;">For executables and apps, the build system builds only the 64-bit version by default, but you can override this setting by using a global <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">BoardConfig.mk</code> variable or a module-scoped variable.</p><p style="margin: 0px 0px 15px; padding: 0px 0px 0px 10px; border-left-width: 4px; border-left-style: solid; border-color: rgb(255, 136, 0);"><strong style="font-weight: bold; color: rgb(34, 34, 34);">Caution:</strong> If an app exposes an API to other apps that can be either 32- or 64-bit, the app must have the<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">android:multiarch</code> property set to a value of <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">true</code> within its manifest to avoid potential errors.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Product Configuration</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">In <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">BoardConfig.mk</code>, we added the following variables to configure the second CPU architecture and ABI:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><span style="color: rgb(0, 0, 0);">TARGET_2ND_ARCH<br/>TARGET_2ND_ARCH_VARIANT<br/>TARGET_2ND_CPU_VARIANT<br/>TARGET_2ND_CPU_ABI<br/>TARGET_2ND_CPU_ABI2</span></pre><p style="margin: 0px 0px 15px;">You can see an example in <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">build/target/board/generic_arm64/BoardConfig.mk</code>.</p><p style="margin: 0px 0px 15px;">If you want the build system to build 32-bit executables and apps by default, set the following variable:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><span style="color: rgb(0, 0, 0);">TARGET_PREFER_32_BIT </span><span style="color: rgb(102, 102, 0);">:=</span><span style="color: rgb(0, 0, 0);"> </span><span style="color: rgb(0, 0, 136);">true</span></pre><p style="margin: 0px 0px 15px;">However, you can override this setting by using module-specific variables in <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">Android.mk</code>.</p><p style="margin: 0px 0px 15px;">In a Multilib build, module names in <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">PRODUCT_PACKAGES</code> cover both the 32-bit and 64-bit binaries, as long as they are defined by the build system. For libraries pulled in by dependency, a 32-bit library is installed only if it’s required by another 32-bit library or executable. The same is true for 64-bit libraries.</p><p style="margin: 0px 0px 15px;">However, module names on the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make</code> command line cover only the 64-bit version. For example, after running<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">lunch aosp_arm64-eng</code>,<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make libc</code> builds only the 64-bit libc. To build the 32-bit libc, you need to run <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">make libc_32</code>.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Module Definition in Android.mk</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">You can use the <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MULTILIB</code> variable to configure your build for 32-bit and/or 64-bit and override the global<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">TARGET_PREFER_32_BIT</code>.</p><p style="margin: 0px 0px 15px;">Set <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MULTILIB</code> to one of the following:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;">&quot;both”: build both 32-bit and 64-bit.</li><li style="margin: 0px 0px 5px;">“32”: build only 32-bit.</li><li style="margin: 0px 0px 5px;">“64”: build only 64-bit.</li><li style="margin: 0px 0px 5px;">“first”: build for only the first arch (32-bit in 32-bit devices and 64-bit in 64-bit devices).</li><li style="margin: 0px 0px 5px;">“”: the default; the build system decides what arch to build based on the module class and other LOCAL_ variables, such as LOCAL_MODULE_TARGET_ARCH, LOCAL_32_BIT_ONLY, etc.</li></ul><p style="margin: 0px 0px 15px;">In a Multilib build, conditionals like <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">ifeq $(TARGET_ARCH)</code> don’t work any more.</p><p style="margin: 0px 0px 15px;">If you want to build your module for some specific arch(s), the following variables can help you:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;">LOCAL_MODULE_TARGET_ARCH<br/>
It can be set to a list of archs, something like “arm x86 arm64”. Only if the arch being built is among that list will the current module be included by the build system.</li><li style="margin: 0px 0px 5px;">LOCAL_MODULE_UNSUPPORTED_TARGET_ARCH<br/>
The opposite of LOCAL_MODULE_TARGET_ARCH. Only if the arch being built is not among the list, the current module will be included.</li></ul><p style="margin: 0px 0px 15px;">There are minor variants of the above two variables:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;">LOCAL_MODULE_TARGET_ARCH_WARN</li><li style="margin: 0px 0px 5px;">LOCAL_MODULE_UNSUPPORTED_TARGET_ARCH_WARN</li></ul><p style="margin: 0px 0px 15px;">The build system will give warning if the current module is skipped due to archs limited by them.</p><p style="margin: 0px 0px 15px;">To set up arch-specific build flags, use the arch-specific LOCAL_ variables. An arch-specific LOCAL_ variable is a normal LOCAL_ variable with an arch suffix, for example:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_SRC_FILES_arm, LOCAL_SRC_FILES_x86,</code></li><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_CFLAGS_arm, LOCAL_CFLAGS_arm64,</code></li><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_LDFLAGS_arm, LOCAL_LDFLAGS_arm64,</code></li></ul><p style="margin: 0px 0px 15px;">Those variables will be applied only if a binary is currently being built for that arch.</p><p style="margin: 0px 0px 15px;">Sometimes it’s more convenient to set up flags based on whether the binary is currently being built for 32-bit or 64-bit. In that case you can use the LOCAL_ variable with a _32 or _64 suffix, for example:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_SRC_FILES_32, LOCAL_SRC_FILES_64,</code></li><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_CFLAGS_32, LOCAL_CFLAGS_64,</code></li><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_LDFLAGS_32, LOCAL_LDFLAGS_64,</code></li></ul><p style="margin: 0px 0px 15px;">Note that not all of the LOCAL_ variables support the arch-specific variants. For an up-to-date list of such variables, refer to <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">build/core/clear_vars.mk</code>.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Install path</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">In the past, you could use LOCAL_MODULE_PATH to install a library to a location other than the default one. For example, <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MODULE_PATH := $(TARGET_OUT_SHARED_LIBRARIES)/hw</code>.</p><p style="margin: 0px 0px 15px;">In Multilib build, use LOCAL_MODULE_RELATIVE_PATH instead:</p><pre style="font-size: 13px; margin: 0px 0px 1em; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace; padding: 1em; overflow: auto; border: 1px solid rgb(221, 221, 221); background: rgb(247, 247, 247);"><span style="color: rgb(0, 0, 0);">LOCAL_MODULE_RELATIVE_PATH </span><span style="color: rgb(102, 102, 0);">:=</span><span style="color: rgb(0, 0, 0);"> hw</span></pre><p style="margin: 0px 0px 15px;">so that both the 64-bit and 32-bit libraries can be installed to the right place.</p><p style="margin: 0px 0px 15px;">If you build an executable as both 32-bit and 64-bit, you’ll need to use one of the following variables to distinguish the install path:</p><ul style="margin: 0px 0px 15px 18px; padding: 0px;"><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MODULE_STEM_32, LOCAL_MODULE_STEM_64</code><br/>
Specifies the installed file name.</li><li style="margin: 0px 0px 5px;"><code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MODULE_PATH_32, LOCAL_MODULE_PATH_64</code><br/>
Specifies the install path.</li></ul><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Generated sources</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">In a Multilib build, if you generate source files to <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$(local-intermediates-dir)</code> (or <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$(intermediates-dir-for) </code>with explicit variables), it won’t reliably work any more. That’s because the intermediate generated sources will be required by both 32-bit and 64-bit build, but <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$(local-intermediates-dir)</code> only points to one of the two intermediate directories.</p><p style="margin: 0px 0px 15px;">Happily, the build system now provides a dedicated, Multilib-friendly, intermediate directory for generating sources. You can call<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"> $(local-generated-sources-dir)</code> or <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$(generated-sources-dir-for)</code> to get the directory’s path. Their usages are similar to <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$(local-intermediates-dir)</code> and <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">$(intermediates-dir-for)</code>.</p><p style="margin: 0px 0px 15px;">If a source file is generated to the new dedicated directory and picked up by <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_GENERATED_SOURCES</code>, it is built for both 32-bit and 64-bit in multilib build.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Prebuilts</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">In Multilib, you can’t use <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">TARGET_ARCH</code> (or together with <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">TARGET_2ND_ARCH</code>) to tell the build system what arch the prebuilt binary is targeted for. Use the aforementioned <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_</code> variable <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MODULE_TARGET_ARCH</code> or<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MODULE_UNSUPPORTED_TARGET_ARCH</code> instead.</p><p style="margin: 0px 0px 15px;">With these variables, the build system can choose the corresponding 32-bit prebuilt binary even if it’s currently doing a 64-bit Multilib build.</p><p style="margin: 0px 0px 15px;">If you want to use the chosen arch to compute the source path for the prebuilt binary , you can call<code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;"> $(get-prebuilt-src-arch)</code>.</p><h2 style="color: rgb(51, 51, 51); font-size: 26px; margin: 32px 0px 0px; padding: 0px; font-weight: 300;">Dex-preopt</h2><hr style="height: 1px; margin: 5px 0px 20px; border: 0px; background: rgb(204, 204, 204);"/><p style="margin: 0px 0px 15px;">For 64-bit devices, by default we generate both 32-bit and 64-bit odex files for the boot image and any Java libraries. For APKs, by default we generate odex only for the primary 64-bit arch. If an app will be launched in both 32-bit and 64-bit processes, please use <code style="font-size: 13px; color: rgb(0, 102, 0); font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-family: monospace;">LOCAL_MULTILIB := both</code> to make sure both 32-bit and 64-bit odex files are generated. That flag also tells the build system to include both 32-bit and 64-bit JNI libraries, if the app has any.</p></div><div style="margin: 10px auto 0px; width: auto; clear: both; font-size: 11px; color: rgb(153, 153, 153); padding: 15px 0px;"><div style="margin: 0px 0px 0px 10px; font-size: 14px; float: right !important;"><a href="http://source.android.com/source/64-bit-builds.html#" style="border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; border-radius: 2px; cursor: pointer; display: inline-block; border: 1px solid rgb(57, 144, 171); color: rgb(255, 255, 255); margin-right: 16px; font-weight: 400; min-width: 54px; outline: 0px; padding: 8px 15px; text-align: center; text-decoration: none; background-image: -webkit-linear-gradient(top, rgb(47, 173, 219), rgb(0, 153, 204)); background-color: rgb(0, 153, 204);">Send Feedback</a></div><div>Except as noted, this content is licensed under <a href="http://creativecommons.org/licenses/by/2.5/" style="color: rgb(37, 138, 175); text-decoration: none;">Creative Commons Attribution 2.5</a>. For details and restrictions, see the <a href="http://source.android.com/license.html" style="color: rgb(37, 138, 175); text-decoration: none;">Content License</a>.</div><div style="margin: 0px 0px 15px;"><div><a href="http://source.android.com/source/index.html" style="color: rgb(37, 138, 175); text-decoration: none;">About Android</a>  |  <a href="http://source.android.com/source/community.html" style="color: rgb(37, 138, 175); text-decoration: none;">Community</a>  |  <a href="http://source.android.com/legal.html" style="color: rgb(37, 138, 175); text-decoration: none;">Legal</a>  | </div></div></div></div></div></span>
</div></body></html> 